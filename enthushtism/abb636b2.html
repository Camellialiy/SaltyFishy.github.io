<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>初识go | 摘星崖</title><meta name="author" content="Enthushtism_"><meta name="copyright" content="Enthushtism_"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="纪录一些go的初学记录">
<meta property="og:type" content="article">
<meta property="og:title" content="初识go">
<meta property="og:url" content="https://enthushtism.top/enthushtism/abb636b2.html">
<meta property="og:site_name" content="摘星崖">
<meta property="og:description" content="纪录一些go的初学记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://enthushtism.top/img/%E5%88%9D%E8%AF%86go.jpg">
<meta property="article:published_time" content="2023-01-06T07:14:45.000Z">
<meta property="article:modified_time" content="2023-01-18T13:44:32.633Z">
<meta property="article:author" content="Enthushtism_">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://enthushtism.top/img/%E5%88%9D%E8%AF%86go.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://enthushtism.top/enthushtism/abb636b2"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"NKSY29S9JI","apiKey":"8d4250e2ca15c28ffb5d99b4a31988c1","indexName":"Hexo","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":"100# When will it be shown","position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '初识go',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-18 21:44:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script async="async">const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}
setTimeout(function(){preloader.endLoading();}, 5000);</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/talk/"><i class="fa-fw fas fa-coffee"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/plan/"><i class="fa-fw fas fa-paper-plane"></i><span> 待更新计划</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/%E5%88%9D%E8%AF%86go.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">摘星崖</a></span><div id="menus"></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/talk/"><i class="fa-fw fas fa-coffee"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/plan/"><i class="fa-fw fas fa-paper-plane"></i><span> 待更新计划</span></a></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">初识go</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-06T07:14:45.000Z" title="发表于 2023-01-06 15:14:45">2023-01-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-18T13:44:32.633Z" title="更新于 2023-01-18 21:44:32">2023-01-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/go/">go</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>53分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="初识go"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h1><h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>在 $Go$ 中，使用关键字 $var$ 声明变量</p>
<p>可以在声明的同时指定类型并初始化</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">"initial"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b, c <span class="type">int</span> = <span class="number">1</span>, <span class="number">2</span> <span class="comment">//声明并初始化</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="literal">true</span> <span class="comment">//给出值，go自动推导类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> e <span class="type">int</span> <span class="comment">//只给出类型，默认初始化</span></span><br><span class="line"></span><br><span class="line">f := <span class="string">"go"</span> <span class="comment">//简写</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>跟大多数语言一样，添加关键字 $const$ 修饰即可</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s <span class="type">string</span> = <span class="string">"constant"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> n = <span class="number">500000000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> d = <span class="number">3e20</span> / n</span><br></pre></td></tr></tbody></table></figure>
<h3 id="For循环"><a href="#For循环" class="headerlink" title="For循环"></a>For循环</h3><p>基本使用方式也同大多数语言一样</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i &lt;= <span class="number">3</span> { <span class="comment">//不同于C++，省略成分不需要分号</span></span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j := <span class="number">7</span>; j &lt;= <span class="number">9</span>; j++ {</span><br><span class="line">    fmt.Println(j)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> {   <span class="comment">//不同于C++，省略成分不需要分号</span></span><br><span class="line">    fmt.Println(<span class="string">"loop"</span>)</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n := <span class="number">0</span>; n &lt;= <span class="number">5</span>; n++ {</span><br><span class="line">    <span class="keyword">if</span> n%<span class="number">2</span> == <span class="number">0</span> {</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    }</span><br><span class="line">    fmt.Println(n)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="If-Else"><a href="#If-Else" class="headerlink" title="If/Else"></a>If/Else</h3><p>需要注意的是， $Go$ 中 $if/else$ 语句的位置不能换行</p>
<p>需要注意的是， $Go$ 没有三目运算符</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="number">7</span>%<span class="number">2</span> == <span class="number">0</span> {</span><br><span class="line">    fmt.Println(<span class="string">"7 is even"</span>)</span><br><span class="line">} <span class="keyword">else</span> { <span class="comment">//不同于C++，此处不能换行</span></span><br><span class="line">    fmt.Println(<span class="string">"7 is odd"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="number">8</span>%<span class="number">4</span> == <span class="number">0</span> {</span><br><span class="line">    fmt.Println(<span class="string">"8 is divisible by 4"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> num := <span class="number">9</span>; num &lt; <span class="number">0</span> {</span><br><span class="line">    fmt.Println(num, <span class="string">"is negative"</span>)</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> num &lt; <span class="number">10</span> {  <span class="comment">//不同于C++，此处不能换行</span></span><br><span class="line">    fmt.Println(num, <span class="string">"has 1 digit"</span>)</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    fmt.Println(num, <span class="string">"has multiple digits"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h3><p>与 $C++$ 语言不同，  $Go$中的 $switch$ 不但不需要 $break$， 同时还支持表达式</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">2</span></span><br><span class="line">fmt.Print(<span class="string">"write "</span>, i, <span class="string">" as "</span>)</span><br><span class="line"><span class="keyword">switch</span> i {</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    	fmt.Println(<span class="string">"one"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    	fmt.Println(<span class="string">"two"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    	fmt.Println(<span class="string">"three"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> time.Now().Weekday() {</span><br><span class="line">    <span class="keyword">case</span> time.Saturday, time.Sunday:</span><br><span class="line">    	fmt.Println(<span class="string">"It's the weekend"</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    	fmt.Println(<span class="string">"It's a weekday"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">t := time.Now()</span><br><span class="line"><span class="keyword">switch</span> {</span><br><span class="line">    <span class="keyword">case</span> t.Hour() &lt; <span class="number">12</span>:  <span class="comment">//go支持switch表达式</span></span><br><span class="line">    	fmt.Println(<span class="string">"It's before noon"</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    	fmt.Println(<span class="string">"It's after noon"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">whatAmI := <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">interface</span>{})</span></span> { <span class="comment">//一种名为类型开关的用法</span></span><br><span class="line">    <span class="keyword">switch</span> t := i.(<span class="keyword">type</span>) {</span><br><span class="line">        <span class="keyword">case</span> <span class="type">bool</span>:</span><br><span class="line">        	fmt.Println(<span class="string">"I'm a bool"</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">        	fmt.Println(<span class="string">"I'm an int"</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        	fmt.Printf(<span class="string">"Don't know type %T\n"</span>, t)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">whatAmI(<span class="literal">true</span>)</span><br><span class="line">whatAmI(<span class="number">1</span>)</span><br><span class="line">whatAmI(<span class="string">"hey"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="常用数据结构"><a href="#常用数据结构" class="headerlink" title="常用数据结构"></a>常用数据结构</h2><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>在 $Go$ 中， 数组是一个具有固定类型和固定大小的元素的集合， 一旦初始化大小和类型就不可改变</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">10</span>]<span class="type">int</span></span><br><span class="line">[<span class="number">200</span>]<span class="keyword">interface</span>{}</span><br><span class="line"><span class="comment">//基本初始化方式</span></span><br><span class="line">arr1 := [<span class="number">3</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br><span class="line">arr2 := [...]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}</span><br></pre></td></tr></tbody></table></figure>
<p>在声明一个数组的时候，可以同时对其初始化</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a [<span class="number">5</span>]<span class="type">int</span> <span class="comment">//声明类型和大小，默认初始化</span></span><br><span class="line">fmt.Println(<span class="string">"emp:"</span>, a)</span><br><span class="line"></span><br><span class="line">a[<span class="number">4</span>] = <span class="number">100</span></span><br><span class="line">fmt.Println(<span class="string">"set:"</span>, a)</span><br><span class="line">fmt.Println(<span class="string">"get:"</span>, a[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"len:"</span>, <span class="built_in">len</span>(a))</span><br><span class="line"></span><br><span class="line">b := [<span class="number">5</span>]<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>} <span class="comment">//声明并初始化</span></span><br><span class="line">fmt.Println(<span class="string">"dcl:"</span>, b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> twoD [<span class="number">2</span>][<span class="number">3</span>]<span class="type">int</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ {</span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">3</span>; j++ {</span><br><span class="line">        twoD[i][j] = i + j</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">fmt.Println(<span class="string">"2d: "</span>, twoD)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><p>切片是一种动态数组，其长度不是固定的，在容量不足时会自动扩容</p>
<p>由于切片的长度不固定，声明一个切片只需要指定其元素类型</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[]<span class="type">int</span></span><br><span class="line">[]<span class="keyword">interface</span>{}</span><br><span class="line"><span class="comment">//基本初始化方式</span></span><br><span class="line">arr[<span class="number">0</span>:<span class="number">3</span>] or slice[<span class="number">0</span>:<span class="number">3</span>] <span class="comment">//通过下标获得原始数组或切片的一部分</span></span><br><span class="line">slice := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>} <span class="comment">//创建并初始化切片</span></span><br><span class="line">slice := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">10</span>) <span class="comment">//创建一个长度为10的切片，容量未指定</span></span><br></pre></td></tr></tbody></table></figure>
<p>切片有许多常用操作</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">s := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">3</span>)</span><br><span class="line">fmt.Println(<span class="string">"emp:"</span>, s)</span><br><span class="line"></span><br><span class="line">s[<span class="number">0</span>] = <span class="string">"a"</span></span><br><span class="line">s[<span class="number">1</span>] = <span class="string">"b"</span></span><br><span class="line">s[<span class="number">2</span>] = <span class="string">"c"</span></span><br><span class="line">fmt.Println(<span class="string">"set:"</span>, s)</span><br><span class="line">fmt.Println(<span class="string">"get:"</span>, s[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"len:"</span>, <span class="built_in">len</span>(s))</span><br><span class="line"></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="string">"d"</span>) <span class="comment">//追加元素，此操作可能返回一个新的slice，所以需要赋值</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="string">"e"</span>, <span class="string">"f"</span>)</span><br><span class="line">fmt.Println(<span class="string">"apd:"</span>, s)</span><br><span class="line"></span><br><span class="line">c := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="built_in">len</span>(s))</span><br><span class="line"><span class="built_in">copy</span>(c, s) <span class="comment">//复制s的内容给c</span></span><br><span class="line">fmt.Println(<span class="string">"cpy:"</span>, c)</span><br><span class="line"></span><br><span class="line">l := s[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">fmt.Println(<span class="string">"sl1:"</span>, l)</span><br><span class="line"></span><br><span class="line">l = s[:<span class="number">5</span>]</span><br><span class="line">fmt.Println(<span class="string">"sl2:"</span>, l)</span><br><span class="line"></span><br><span class="line">l = s[<span class="number">2</span>:]</span><br><span class="line">fmt.Println(<span class="string">"sl3:"</span>, l)</span><br><span class="line"></span><br><span class="line">t := []<span class="type">string</span>{<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>}</span><br><span class="line">fmt.Println(<span class="string">"dcl:"</span>, t)</span><br><span class="line"></span><br><span class="line">twoD := <span class="built_in">make</span>([][]<span class="type">int</span>, <span class="number">3</span>) <span class="comment">//二维切片</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ {</span><br><span class="line">    innerLen := i + <span class="number">1</span></span><br><span class="line">    twoD[i] = <span class="built_in">make</span>([]<span class="type">int</span>, innerLen)</span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; innerLen; j++ {</span><br><span class="line">        twoD[i][j] = i + j</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">fmt.Println(<span class="string">"2d: "</span>, twoD)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h3><p>在 $Go$ 中，关键字 $map$ 被用来作为哈希（字典）类型的关键字</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>) <span class="comment">//创建一个哈希表 make(map[key-type]value-type)</span></span><br><span class="line"></span><br><span class="line">m[<span class="string">"k1"</span>] = <span class="number">7</span></span><br><span class="line">m[<span class="string">"k2"</span>] = <span class="number">13</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"map:"</span>, m) <span class="comment">//输出map等价于输出所有键值对</span></span><br><span class="line"></span><br><span class="line">v1 := m[<span class="string">"k1"</span>]</span><br><span class="line">fmt.Println(<span class="string">"v1: "</span>, v1)</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"len:"</span>, <span class="built_in">len</span>(m))</span><br><span class="line"></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">"k2"</span>) <span class="comment">//删除k-v对</span></span><br><span class="line">fmt.Println(<span class="string">"map:"</span>, m)</span><br><span class="line"></span><br><span class="line">_, prs := m[<span class="string">"k2"</span>] <span class="comment">//获取一个map元素时，可以使用第二个参数来知道map中是否存在该key</span></span><br><span class="line">fmt.Println(<span class="string">"prs:"</span>, prs)</span><br><span class="line"></span><br><span class="line">n := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{<span class="string">"foo"</span>: <span class="number">1</span>, <span class="string">"bar"</span>: <span class="number">2</span>} <span class="comment">//创建并初始化</span></span><br><span class="line">fmt.Println(<span class="string">"map:"</span>, n)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>在 $Go$ 中，字符串是一组只读的 $byte$ 的切片，并且其本身是采用 $utf-8$ 编码，因此本质是一个表示 $Unicode$ 编码的整数，在 $Go$ 中，字符的概念被称为 $rune$ 。</p>
<h4 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h4><figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    s <span class="string">"strings"</span> <span class="comment">//相当于别名</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = fmt.Println <span class="comment">//相当于别名</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    str := <span class="string">"helll"</span></span><br><span class="line">    p(<span class="string">"Contains:  "</span>, s.Contains(str, <span class="string">"ll"</span>))</span><br><span class="line">    p(<span class="string">"Count:     "</span>, s.Count(str, <span class="string">"ll"</span>)) <span class="comment">//注意结果是1不是2</span></span><br><span class="line">    p(<span class="string">"HasPrefix: "</span>, s.HasPrefix(str, <span class="string">"he"</span>))</span><br><span class="line">    p(<span class="string">"HasSuffix: "</span>, s.HasSuffix(str, <span class="string">"lll"</span>))</span><br><span class="line">    p(<span class="string">"Index:     "</span>, s.Index(str, <span class="string">"l"</span>))</span><br><span class="line">    p(<span class="string">"Join:      "</span>, s.Join([]<span class="type">string</span>{<span class="string">"a"</span>, <span class="string">"b"</span>}, <span class="string">"-"</span>))</span><br><span class="line">    p(<span class="string">"Repeat:    "</span>, s.Repeat(<span class="string">"a"</span>, <span class="number">5</span>))</span><br><span class="line">    p(<span class="string">"Replace:   "</span>, s.Replace(<span class="string">"foo"</span>, <span class="string">"o"</span>, <span class="string">"0"</span>, <span class="number">-1</span>)) <span class="comment">// -1会替换所有</span></span><br><span class="line">    p(<span class="string">"Replace:   "</span>, s.Replace(<span class="string">"foo"</span>, <span class="string">"o"</span>, <span class="string">"0"</span>, <span class="number">1</span>)) <span class="comment">// 1表示只替换一个</span></span><br><span class="line">    p(<span class="string">"Split:     "</span>, s.Split(<span class="string">"a-b-c-d-e"</span>, <span class="string">"-"</span>))</span><br><span class="line">    p(<span class="string">"ToLower:   "</span>, s.ToLower(str))</span><br><span class="line">    p(<span class="string">"ToUpper:   "</span>, s.ToUpper(str))</span><br><span class="line"></span><br><span class="line">    p(<span class="string">"Len: "</span>, <span class="built_in">len</span>(<span class="string">"hello"</span>))</span><br><span class="line">    p(<span class="string">"Char:"</span>, <span class="string">"hello"</span>[<span class="number">1</span>])</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出结果如下</span></span><br><span class="line">Contains:   <span class="literal">true</span></span><br><span class="line">Count:      <span class="number">1</span></span><br><span class="line">HasPrefix:  <span class="literal">true</span></span><br><span class="line">HasSuffix:  <span class="literal">true</span></span><br><span class="line">Index:      <span class="number">1</span></span><br><span class="line">Join:       a-b</span><br><span class="line">Repeat:     aaaaa</span><br><span class="line">Replace:    f00</span><br><span class="line">Replace:    f0o</span><br><span class="line">Split:      [a b c d e]</span><br><span class="line">ToLower:    helll</span><br><span class="line">ToUpper:    HELLL</span><br><span class="line"></span><br><span class="line">Len:  <span class="number">5</span></span><br><span class="line">Char: <span class="number">101</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="字符串与数字的转换"><a href="#字符串与数字的转换" class="headerlink" title="字符串与数字的转换"></a>字符串与数字的转换</h4><p>在 $Go$ 中，字符串与数字的转换是通过 $strconv$ 实现的</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    f, _ := strconv.ParseFloat(<span class="string">"1.234"</span>, <span class="number">64</span>) <span class="comment">// 转换成浮点数，第二个参数表示多少位存储</span></span><br><span class="line">    fmt.Println(f)</span><br><span class="line"></span><br><span class="line">    i, _ := strconv.ParseInt(<span class="string">"123"</span>, <span class="number">0</span>, <span class="number">64</span>) <span class="comment">// 转换成整数，第一个参数表示进制（0表示自动推导），第二个参数表示多少位存储</span></span><br><span class="line">    fmt.Println(i)</span><br><span class="line"></span><br><span class="line">    d, _ := strconv.ParseInt(<span class="string">"0x1c8"</span>, <span class="number">0</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(d)</span><br><span class="line"></span><br><span class="line">    u, _ := strconv.ParseUint(<span class="string">"789"</span>, <span class="number">0</span>, <span class="number">64</span>) <span class="comment">// 转换成无符号数</span></span><br><span class="line">    fmt.Println(u)</span><br><span class="line"></span><br><span class="line">    k, _ := strconv.Atoi(<span class="string">"135"</span>)</span><br><span class="line">    fmt.Println(k)</span><br><span class="line"></span><br><span class="line">    _, e := strconv.Atoi(<span class="string">"wat"</span>) <span class="comment">// 不是数字，会返回错误</span></span><br><span class="line">    fmt.Println(e)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line"><span class="number">1.234</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">456</span></span><br><span class="line"><span class="number">789</span></span><br><span class="line"><span class="number">135</span></span><br><span class="line">strconv.Atoi: parsing <span class="string">"wat"</span>: invalid syntax</span><br></pre></td></tr></tbody></table></figure>
<h4 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h4><p>只需要知道即可</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">%v 结构体、哈希表等</span><br><span class="line">%+v 带上字段名</span><br><span class="line">%#v 附上详细信息</span><br><span class="line">%T 类型</span><br><span class="line">%t 布尔</span><br><span class="line">%c 字符</span><br><span class="line">%s 字符串</span><br><span class="line">%d 十进制数</span><br><span class="line">%b 二进制数</span><br><span class="line">%x 十六进制数</span><br><span class="line">%f 小数</span><br><span class="line">%e/%E 科学计数法，采取e/E</span><br><span class="line">%q 带双引号输出</span><br><span class="line">%p 指针</span><br><span class="line">+- | <span class="number">0123456789</span> | . | <span class="number">0123456789</span> | f 左右对齐/数位/小数点后位 的小数</span><br><span class="line">Sprintf 输出到一个字符串</span><br><span class="line">Fprintf 输出到文件或流</span><br></pre></td></tr></tbody></table></figure>
<h4 id="文本模板"><a href="#文本模板" class="headerlink" title="文本模板"></a>文本模板</h4><p>位于 $text/template$ 包中，其主要作用是为用户自定义展示模板提供支持</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"text/template"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    t1 := template.New(<span class="string">"t1"</span>) <span class="comment">// 可以使用New创建一个模板</span></span><br><span class="line">    t1, err := t1.Parse(<span class="string">"Value is {{.}}\n"</span>) <span class="comment">// 使用Parse解析，其中{{.}}的内容会被替换为正文</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    t1 = template.Must(t1.Parse(<span class="string">"Value: {{.}}\n"</span>)) <span class="comment">// 通过使用Must可以在Parse失败的时候引发panic</span></span><br><span class="line"></span><br><span class="line">    t1.Execute(os.Stdout, <span class="string">"some text"</span>) <span class="comment">// 通过Execute调用</span></span><br><span class="line">    t1.Execute(os.Stdout, <span class="number">5</span>)</span><br><span class="line">    t1.Execute(os.Stdout, []<span class="type">string</span>{</span><br><span class="line">        <span class="string">"Go"</span>,</span><br><span class="line">        <span class="string">"Rust"</span>,</span><br><span class="line">        <span class="string">"C++"</span>,</span><br><span class="line">        <span class="string">"C#"</span>,</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    Create := <span class="function"><span class="keyword">func</span><span class="params">(name, t <span class="type">string</span>)</span></span> *template.Template { <span class="comment">// 构造一个函数来辅助创建文本模板</span></span><br><span class="line">        <span class="keyword">return</span> template.Must(template.New(name).Parse(t))</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    t2 := Create(<span class="string">"t2"</span>, <span class="string">"Name: {{.Name}}\n"</span>) <span class="comment">// 可以在辅助文本中使用成员，方式为{{.FieldName}}</span></span><br><span class="line"></span><br><span class="line">    t2.Execute(os.Stdout, <span class="keyword">struct</span> {</span><br><span class="line">        Name <span class="type">string</span></span><br><span class="line">    }{<span class="string">"Jane Doe"</span>})</span><br><span class="line"></span><br><span class="line">    t2.Execute(os.Stdout, <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>{ <span class="comment">// map也可以</span></span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"Mickey Mouse"</span>,</span><br><span class="line">    })</span><br><span class="line"></span><br><span class="line">    t3 := Create(<span class="string">"t3"</span>,</span><br><span class="line">        <span class="string">"{{if . -}} yes {{else -}} no {{end}}\n"</span>) <span class="comment">// 可以使用 if else end 来实现条件模板，注意{{}}内空格的使用，除此之外，使用-可以去除后方紧跟的一个空格</span></span><br><span class="line">    t3.Execute(os.Stdout, <span class="string">"not empty"</span>)</span><br><span class="line">    t3.Execute(os.Stdout, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    t4 := Create(<span class="string">"t4"</span>,</span><br><span class="line">        <span class="string">"Range: {{range .}}{{.}} {{end}}\n"</span>) <span class="comment">// 可以使用range end遍历</span></span><br><span class="line">    t4.Execute(os.Stdout,</span><br><span class="line">        []<span class="type">string</span>{</span><br><span class="line">            <span class="string">"Go"</span>,</span><br><span class="line">            <span class="string">"Rust"</span>,</span><br><span class="line">            <span class="string">"C++"</span>,</span><br><span class="line">            <span class="string">"C#"</span>,</span><br><span class="line">        })</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 结果如下</span></span><br><span class="line">Value: some text</span><br><span class="line">Value: <span class="number">5</span></span><br><span class="line">Value: [Go Rust C++ C#]</span><br><span class="line">Name: Jane Doe</span><br><span class="line">Name: Mickey Mouse</span><br><span class="line">yes</span><br><span class="line">no</span><br><span class="line">Range: Go Rust C++ C#</span><br></pre></td></tr></tbody></table></figure>
<h4 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h4><p>在 $Go$ 中，可以很方便的实现序列化和反序列化</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"encoding/json"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> response1 <span class="keyword">struct</span> {</span><br><span class="line">    Page   <span class="type">int</span></span><br><span class="line">    Fruits []<span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> response2 <span class="keyword">struct</span> {</span><br><span class="line">    Page   <span class="type">int</span>      <span class="string">`json:"pAGE"`</span> <span class="comment">// 添加此格式可以让key变为指定的格式</span></span><br><span class="line">    Fruits []<span class="type">string</span> <span class="string">`json:"fruits"`</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    slcD := []<span class="type">string</span>{<span class="string">"apple"</span>, <span class="string">"peach"</span>, <span class="string">"pear"</span>}</span><br><span class="line">    slcB, _ := json.Marshal(slcD)</span><br><span class="line">    fmt.Println(slcB) <span class="comment">// 直接输入结果会输出序列化的数字</span></span><br><span class="line">    fmt.Println(<span class="type">string</span>(slcB))</span><br><span class="line"></span><br><span class="line">    mapD := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{<span class="string">"apple"</span>: <span class="number">5</span>, <span class="string">"lettuce"</span>: <span class="number">7</span>}</span><br><span class="line">    mapB, _ := json.Marshal(mapD)</span><br><span class="line">    fmt.Println(<span class="type">string</span>(mapB))</span><br><span class="line"></span><br><span class="line">    res1D := &amp;response1{</span><br><span class="line">        Page:   <span class="number">1</span>,</span><br><span class="line">        Fruits: []<span class="type">string</span>{<span class="string">"apple"</span>, <span class="string">"peach"</span>, <span class="string">"pear"</span>}}</span><br><span class="line">    res1B, _ := json.Marshal(res1D)</span><br><span class="line">    fmt.Println(<span class="type">string</span>(res1B))</span><br><span class="line"></span><br><span class="line">    res2D := &amp;response2{</span><br><span class="line">        Page:   <span class="number">1</span>,</span><br><span class="line">        Fruits: []<span class="type">string</span>{<span class="string">"apple"</span>, <span class="string">"peach"</span>, <span class="string">"pear"</span>}}</span><br><span class="line">    res2B, _ := json.Marshal(res2D)</span><br><span class="line">    fmt.Println(<span class="type">string</span>(res2B))</span><br><span class="line"></span><br><span class="line">    byt := []<span class="type">byte</span>(<span class="string">`{"num":6.13,"strs":["a","b"]}`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dat <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>{}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := json.Unmarshal(byt, &amp;dat); err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(dat)</span><br><span class="line"></span><br><span class="line">    num := dat[<span class="string">"num"</span>].(<span class="type">float64</span>) <span class="comment">// 获取值需要类型转换</span></span><br><span class="line">    fmt.Println(num)</span><br><span class="line"></span><br><span class="line">    strs := dat[<span class="string">"strs"</span>].([]<span class="keyword">interface</span>{}) <span class="comment">// 对于嵌套的需要多次类型转换</span></span><br><span class="line">    str1 := strs[<span class="number">0</span>].(<span class="type">string</span>)</span><br><span class="line">    fmt.Println(str1)</span><br><span class="line"></span><br><span class="line">    str := <span class="string">`{"page": 1, "fruits": ["apple", "peach"]}`</span></span><br><span class="line">    res := response2{}</span><br><span class="line">    json.Unmarshal([]<span class="type">byte</span>(str), &amp;res) <span class="comment">// 反序列化的第一个参数为json，第二个参数必须为指针</span></span><br><span class="line">    fmt.Println(res)</span><br><span class="line">    fmt.Println(res.Fruits[<span class="number">0</span>])</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">[<span class="number">91</span> <span class="number">34</span> <span class="number">97</span> <span class="number">112</span> <span class="number">112</span> <span class="number">108</span> <span class="number">101</span> <span class="number">34</span> <span class="number">44</span> <span class="number">34</span> <span class="number">112</span> <span class="number">101</span> <span class="number">97</span> <span class="number">99</span> <span class="number">104</span> <span class="number">34</span> <span class="number">44</span> <span class="number">34</span> <span class="number">112</span> <span class="number">101</span> <span class="number">97</span> <span class="number">114</span> <span class="number">34</span> <span class="number">93</span>]</span><br><span class="line">[<span class="string">"apple"</span>,<span class="string">"peach"</span>,<span class="string">"pear"</span>]</span><br><span class="line">{<span class="string">"apple"</span>:<span class="number">5</span>,<span class="string">"lettuce"</span>:<span class="number">7</span>}</span><br><span class="line">{<span class="string">"Page"</span>:<span class="number">1</span>,<span class="string">"Fruits"</span>:[<span class="string">"apple"</span>,<span class="string">"peach"</span>,<span class="string">"pear"</span>]}</span><br><span class="line">{<span class="string">"pAGE"</span>:<span class="number">1</span>,<span class="string">"fruits"</span>:[<span class="string">"apple"</span>,<span class="string">"peach"</span>,<span class="string">"pear"</span>]}</span><br><span class="line"><span class="keyword">map</span>[num:<span class="number">6.13</span> strs:[a b]]</span><br><span class="line"><span class="number">6.13</span></span><br><span class="line">a</span><br><span class="line">{<span class="number">1</span> [apple peach]}</span><br><span class="line">apple</span><br></pre></td></tr></tbody></table></figure>
<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><p>正则表达式是一个非常强大的模式匹配的工具，在 $Go$ 中，使用正则表达式需要引入 $regexp$ 。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"bytes"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"regexp"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    match, _ := regexp.MatchString(<span class="string">"p([a-z]+)ch"</span>, <span class="string">"peach"</span>) <span class="comment">// 测试一个字符串是否满足正则表达式</span></span><br><span class="line">    fmt.Println(match)</span><br><span class="line"></span><br><span class="line">    r, _ := regexp.Compile(<span class="string">"p([a-z]+)ch"</span>) <span class="comment">// 可以通过Complie生成一个Regexp结构体</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(r.MatchString(<span class="string">"peach"</span>)) <span class="comment">// 这个结构体有很多方法，比如是否匹配正则表达式</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(r.FindString(<span class="string">"peach punch"</span>)) <span class="comment">// 在字符串中查找匹配正则表达式的字符串</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"idx:"</span>, r.FindStringIndex(<span class="string">"peach punch"</span>)) <span class="comment">// 在字符串中查找匹配正则表达式的字符串在原串中开始和结束的下标</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(r.FindStringSubmatch(<span class="string">"peach punch"</span>)) <span class="comment">// 返回完全匹配和局部匹配的字符串</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(r.FindStringSubmatchIndex(<span class="string">"peach punch"</span>)) <span class="comment">// 返回完全匹配和局部匹配字符串的开始和结束的下标</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(r.FindAllString(<span class="string">"peach punch pinch"</span>, <span class="number">-1</span>)) <span class="comment">// 带All的函数返回所有的匹配结果，-1表示所有，否则表示匹配次数</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"all:"</span>, r.FindAllStringSubmatchIndex(</span><br><span class="line">        <span class="string">"peach punch pinch"</span>, <span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line">    fmt.Println(r.FindAllString(<span class="string">"peach punch pinch"</span>, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    fmt.Println(r.Match([]<span class="type">byte</span>(<span class="string">"peach"</span>))) <span class="comment">// 除了string，还支持[]byte进行匹配</span></span><br><span class="line"></span><br><span class="line">    r = regexp.MustCompile(<span class="string">"p([a-z]+)ch"</span>) <span class="comment">// 可以对Complie升级为MustComplie，这样在生成失败的时候会返回一个panic来代替错误，更加安全</span></span><br><span class="line">    fmt.Println(<span class="string">"regexp:"</span>, r)</span><br><span class="line"></span><br><span class="line">    fmt.Println(r.ReplaceAllString(<span class="string">"a peach"</span>, <span class="string">"&lt;fruit&gt;"</span>)) <span class="comment">// 还可以将匹配正则表达式的字符串转变为其他字符</span></span><br><span class="line"></span><br><span class="line">    in := []<span class="type">byte</span>(<span class="string">"a peach"</span>)</span><br><span class="line">    out := r.ReplaceAllFunc(in, bytes.ToUpper) <span class="comment">// 可以接受一个函数作为转变规则</span></span><br><span class="line">    fmt.Println(<span class="type">string</span>(out))</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">peach</span><br><span class="line">idx: [<span class="number">0</span> <span class="number">5</span>]</span><br><span class="line">[peach ea]</span><br><span class="line">[<span class="number">0</span> <span class="number">5</span> <span class="number">1</span> <span class="number">3</span>]</span><br><span class="line">[peach punch pinch]</span><br><span class="line">all: [[<span class="number">0</span> <span class="number">5</span> <span class="number">1</span> <span class="number">3</span>] [<span class="number">6</span> <span class="number">11</span> <span class="number">7</span> <span class="number">9</span>] [<span class="number">12</span> <span class="number">17</span> <span class="number">13</span> <span class="number">15</span>]]</span><br><span class="line">[peach punch]</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">regexp: p([a-z]+)ch</span><br><span class="line">a &lt;fruit&gt;</span><br><span class="line">a PEACH</span><br></pre></td></tr></tbody></table></figure>
<h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><p>待补充。。。。</p>
<h2 id="函数结构"><a href="#函数结构" class="headerlink" title="函数结构"></a>函数结构</h2><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>与 $C++$ 等不同， $Go$ 一般方法 $(成员函数)$ 都写在结构体外</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rect <span class="keyword">struct</span> {</span><br><span class="line">    width, height <span class="type">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *rect)</span></span> area() <span class="type">int</span> { <span class="comment">//这是一个有指针类型接收器的方法，因此这里的r其实是一个指针</span></span><br><span class="line">    fmt.Printf(<span class="string">"point copy outside: %p\n"</span>, r)</span><br><span class="line">    <span class="keyword">return</span> r.width * r.height</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r rect)</span></span> perim() <span class="type">int</span> { <span class="comment">//这个接收值，因此这里的r是变量</span></span><br><span class="line">    fmt.Printf(<span class="string">"value copy inside: %p\n"</span>, &amp;r)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*r.width + <span class="number">2</span>*r.height</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    r := rect{width: <span class="number">10</span>, height: <span class="number">5</span>}</span><br><span class="line">    fmt.Printf(<span class="string">"value copy outside: %p\n"</span>, &amp;r)</span><br><span class="line">    fmt.Println(<span class="string">"point area: "</span>, r.area()) <span class="comment">//调用接收器为指针的方法，这种形式的调用可以避免发生临时变量的拷贝</span></span><br><span class="line">    fmt.Println(<span class="string">"value perim:"</span>, r.perim()) <span class="comment">//通过值调用方法，会拷贝一个临时变量</span></span><br><span class="line"></span><br><span class="line">    rp := &amp;r</span><br><span class="line">    fmt.Printf(<span class="string">"point copy outside: %p\n"</span>, rp)</span><br><span class="line">    fmt.Println(<span class="string">"point area: "</span>, rp.area())</span><br><span class="line">    fmt.Println(<span class="string">"value perim:"</span>, rp.perim())</span><br><span class="line">}</span><br><span class="line"><span class="comment">//输出如下</span></span><br><span class="line">value <span class="built_in">copy</span> outside: <span class="number">0xc0000180c0</span></span><br><span class="line">point <span class="built_in">copy</span> outside: <span class="number">0xc0000180c0</span></span><br><span class="line">point area:  <span class="number">50</span></span><br><span class="line">value <span class="built_in">copy</span> inside: <span class="number">0xc0000180e0</span></span><br><span class="line">value perim: <span class="number">30</span></span><br><span class="line">point <span class="built_in">copy</span> outside: <span class="number">0xc0000180c0</span></span><br><span class="line">point <span class="built_in">copy</span> outside: <span class="number">0xc0000180c0</span></span><br><span class="line">point area:  <span class="number">50</span></span><br><span class="line">value <span class="built_in">copy</span> inside: <span class="number">0xc0000180f0</span></span><br><span class="line">value perim: <span class="number">30</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以看到，不管我们使用指针还是变量调用 $area$ 函数，都是传递了地址调用，类似的，不管我们使用指针还是变量调用 $perim$ ，都发生了变量的拷贝，因此，可以认为发生变量的拷贝还是传递地址只取决于函数的接收器。</p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>接口是由方法组成的集合</p>
<p>在 $Go$ 中，实现一个接口，需要实现接口的全部方法</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> geometry <span class="keyword">interface</span> {</span><br><span class="line">    area() <span class="type">float64</span></span><br><span class="line">    perim() <span class="type">float64</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rect <span class="keyword">struct</span> {</span><br><span class="line">    width, height <span class="type">float64</span></span><br><span class="line">}</span><br><span class="line"><span class="keyword">type</span> circle <span class="keyword">struct</span> {</span><br><span class="line">    radius <span class="type">float64</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r rect)</span></span> area() <span class="type">float64</span> {</span><br><span class="line">    <span class="keyword">return</span> r.width * r.height</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r rect)</span></span> perim() <span class="type">float64</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*r.width + <span class="number">2</span>*r.height</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c circle)</span></span> area() <span class="type">float64</span> {</span><br><span class="line">    <span class="keyword">return</span> math.Pi * c.radius * c.radius</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c circle)</span></span> perim() <span class="type">float64</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * math.Pi * c.radius</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">measure</span><span class="params">(g geometry)</span></span> {</span><br><span class="line">    fmt.Println(g)</span><br><span class="line">    fmt.Println(g.area())</span><br><span class="line">    fmt.Println(g.perim())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    r := rect{width: <span class="number">3</span>, height: <span class="number">4</span>}</span><br><span class="line">    c := circle{radius: <span class="number">5</span>}</span><br><span class="line"></span><br><span class="line">    measure(r)</span><br><span class="line">    measure(c)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>不过需要注意，对于结构体来说，不能同时实现接收器为指针和结构体的方法，只能在指针和结构体之间二选一</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>定义来说，就是一个 函数 与其 相关的环境 组合成的一个整体。</p>
<p>在 $Go$ 语言中，支持 <strong>匿名函数</strong> 并利用其构造 <strong>闭包</strong></p>
<p>什么是闭包？按其定义来说，就是一个 <strong>函数</strong> 与其 <strong>相关的环境</strong> 组合成的一个整体。</p>
<p>可以看如下例子</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span> <span class="params">(<span class="type">int</span>)</span></span> <span class="type">int</span> {</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span> <span class="params">(x <span class="type">int</span>)</span></span> <span class="type">int</span> {</span><br><span class="line">        count += x</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    a := add() <span class="comment">// a是一个闭包</span></span><br><span class="line">    fmt.Println(a(<span class="number">1</span>)) <span class="comment">// count初始为0，加1，返回1</span></span><br><span class="line">    fmt.Println(a(<span class="number">2</span>)) <span class="comment">// count为1，加2，返回3</span></span><br><span class="line">    b := add() <span class="comment">// b是另外一个闭包</span></span><br><span class="line">    fmt.Println(b(<span class="number">5</span>)) <span class="comment">// count初始为0，加5，返回5</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>下面是一个闭包的示例</p>
<p>有一个函数 $makeSuffix$ ，这个函数返回了一个指定后缀 $suffix$ 的闭包，这个闭包可以检测输入的文件名是否是以 $suffix$ 作为后缀的，如果是，返回文件名，否则修改后缀为 $suffix$</p>
<p>通过这个函数的封装，我们可以针对性的对不同后缀调用相同的函数，返回不同后缀的闭包，提高了代码的复用性</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeSuffix</span><span class="params">(suffix <span class="type">string</span>)</span></span> <span class="function"><span class="keyword">func</span> <span class="params">()</span></span> <span class="function"><span class="keyword">func</span> <span class="params">(<span class="type">string</span>)</span></span> <span class="type">string</span> { </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span> <span class="params">()</span></span> <span class="function"><span class="keyword">func</span> <span class="params">(<span class="type">string</span>)</span></span> <span class="type">string</span> {</span><br><span class="line">        <span class="keyword">var</span> suf = suffix</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">func</span> <span class="params">(filename <span class="type">string</span>)</span></span> <span class="type">string</span> {</span><br><span class="line">            <span class="keyword">if</span> (strings.HasSuffix(filename,suf)) {</span><br><span class="line">                <span class="keyword">return</span> filename</span><br><span class="line">            } </span><br><span class="line">            <span class="keyword">return</span> filename[:strings.Index(filename, <span class="string">"."</span>)] + suf</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    jpg := makeSuffix(<span class="string">".jpg"</span>)()</span><br><span class="line">    fmt.Println(jpg(<span class="string">"myjpg.jpg"</span>))</span><br><span class="line">    fmt.Println(jpg(<span class="string">"mypng.png"</span>))</span><br><span class="line"></span><br><span class="line">    png := makeSuffix(<span class="string">".png"</span>)()</span><br><span class="line">    fmt.Println(png(<span class="string">"myjpg.png"</span>))</span><br><span class="line">    fmt.Println(png(<span class="string">"mypng.png"</span>))</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出如下</span></span><br><span class="line">myjpg.jpg</span><br><span class="line">mypng.jpg</span><br><span class="line">myjpg.png</span><br><span class="line">mypng.png</span><br></pre></td></tr></tbody></table></figure>
<h3 id="变参函数"><a href="#变参函数" class="headerlink" title="变参函数"></a>变参函数</h3><p>类似 $python、C++$， 在 $Go$ 中，也存在接收可变参数的函数</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(nums ...<span class="type">int</span>)</span></span> { <span class="comment">// 这是一个接受int的可变参数的函数</span></span><br><span class="line">    fmt.Print(nums, <span class="string">" "</span>)</span><br><span class="line">    total := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums {</span><br><span class="line">        total += num</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(total)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    sum(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    sum(<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">    nums := []<span class="type">int</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>} </span><br><span class="line">    sum(nums...) <span class="comment">// 对切片调用需要加上...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h2><p>泛型是 $1.18$ 版本后 $Go$ 新增的内容，提供了强大的模板能力。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MapKeys</span>[<span class="title">K</span> <span class="title">comparable</span>, <span class="title">V</span> <span class="title">any</span>]<span class="params">(m <span class="keyword">map</span>[K]V)</span></span> []K { <span class="comment">// 一个支持泛型的函数，comparable是一个内置的类型，其支持==和!=运算，any是任意类型（interface{}的别名）       </span></span><br><span class="line">    r := <span class="built_in">make</span>([]K, <span class="number">0</span>, <span class="built_in">len</span>(m))                      <span class="comment">// K和V是这两个类型的类型参数</span></span><br><span class="line">    <span class="keyword">for</span> k := <span class="keyword">range</span> m {</span><br><span class="line">        r = <span class="built_in">append</span>(r, k)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> List[T any] <span class="keyword">struct</span> { <span class="comment">// 类似的，可以创建一个支持泛型的结构体</span></span><br><span class="line">    head, tail *element[T]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> element[T any] <span class="keyword">struct</span> {</span><br><span class="line">    next *element[T]</span><br><span class="line">    val  T</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lst *List[T])</span></span> Push(v T) { <span class="comment">// 类似的，对于一个支持泛型的结构体，可以存在方法，注意必须方法的前方的List必须写为List[T]</span></span><br><span class="line">    <span class="keyword">if</span> lst.tail == <span class="literal">nil</span> {</span><br><span class="line">        lst.head = &amp;element[T]{val: v}</span><br><span class="line">        lst.tail = lst.head</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        lst.tail.next = &amp;element[T]{val: v}</span><br><span class="line">        lst.tail = lst.tail.next</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lst *List[T])</span></span> GetAll() []T {</span><br><span class="line">    <span class="keyword">var</span> elems []T</span><br><span class="line">    <span class="keyword">for</span> e := lst.head; e != <span class="literal">nil</span>; e = e.next {</span><br><span class="line">        elems = <span class="built_in">append</span>(elems, e.val)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> elems</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>{<span class="number">1</span>: <span class="string">"2"</span>, <span class="number">2</span>: <span class="string">"4"</span>, <span class="number">4</span>: <span class="string">"8"</span>}</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"keys m:"</span>, MapKeys(m)) <span class="comment">// 编译器可以正常推导类型</span></span><br><span class="line"></span><br><span class="line">    _ = MapKeys[<span class="type">int</span>, <span class="type">string</span>](m)</span><br><span class="line"></span><br><span class="line">    lst := List[<span class="type">int</span>]{} <span class="comment">// 注意，由于List内容为空，因此编译器无法自动推导类型，此时需要显式指定类型</span></span><br><span class="line">    lst.Push(<span class="number">10</span>)</span><br><span class="line">    lst.Push(<span class="number">13</span>)</span><br><span class="line">    lst.Push(<span class="number">23</span>)</span><br><span class="line">    fmt.Println(<span class="string">"list:"</span>, lst.GetAll())</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">keys m: [<span class="number">4</span> <span class="number">1</span> <span class="number">2</span>]</span><br><span class="line">list: [<span class="number">10</span> <span class="number">13</span> <span class="number">23</span>]</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Go-并发编程"><a href="#Go-并发编程" class="headerlink" title="Go 并发编程"></a>Go 并发编程</h2><h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><p>在其它语言中，比如 $Java$ 通过线程来实现并发，而在 $Go$ 中，给出了一种全新的方式支持并发，协程 $goroutine$ 。</p>
<p>协程是一种更加轻量级的线程，因此 $Go$ 可以很轻松的实现上万级别的并发。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(from <span class="type">string</span>)</span></span> {</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ {</span><br><span class="line">        fmt.Println(from, <span class="string">":"</span>, i)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    f(<span class="string">"test"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">go</span> f(<span class="string">"goroutine"</span>)  <span class="comment">// 使用关键字go开启一个协程</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(msg <span class="type">string</span>)</span></span> {</span><br><span class="line">        fmt.Println(msg)</span><br><span class="line">    }(<span class="string">"test go"</span>) <span class="comment">// 可以使用匿名函数</span></span><br><span class="line"></span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    fmt.Println(<span class="string">"done"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">test : <span class="number">0</span></span><br><span class="line">test : <span class="number">1</span></span><br><span class="line">test : <span class="number">2</span></span><br><span class="line">test <span class="keyword">go</span></span><br><span class="line">goroutine : <span class="number">0</span></span><br><span class="line">goroutine : <span class="number">1</span></span><br><span class="line">goroutine : <span class="number">2</span></span><br><span class="line">done</span><br></pre></td></tr></tbody></table></figure>
<p>通过观察输入我们可以发现，通过创建协程，我们的程序变成了异步执行。</p>
<p>多次执行该代码，可能得到不同的结果。</p>
<h3 id="通道"><a href="#通道" class="headerlink" title="通道"></a>通道</h3><p>在协程中，可以通过通道 $channel$ 进行通信</p>
<p>要创建一个通道，需要使用关键字 $make$</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channelName := <span class="built_in">make</span>(<span class="keyword">chan</span> value-<span class="keyword">type</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>下面是一个简单的利用通道实现两个协程通信的例子</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    messages := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>) <span class="comment">// 创建了一个接收string类型的通道</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { messages &lt;- <span class="string">"hey"</span></span><br><span class="line">        messages &lt;- <span class="string">"hello"</span></span><br><span class="line">    }() <span class="comment">// 创建一个协程，在这个协程内向通道发送了一个字符串“hey”和一个字符串"hello"</span></span><br><span class="line"></span><br><span class="line">    msg := &lt;-messages <span class="comment">// 在外部的这个协程内从通道中接收字符串，默认情况下，通道是无缓冲的，因此只有当接收方准备好接收时发送方才会发送，因此这里的输出只有"hey"，因为接收方只准备好接收一个字符串</span></span><br><span class="line">    fmt.Println(msg)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">hey</span><br></pre></td></tr></tbody></table></figure>
<p>通道可以用于同步协程之间的状态</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(done <span class="keyword">chan</span> <span class="type">bool</span>)</span></span> {</span><br><span class="line">    fmt.Print(<span class="string">"working..."</span>)</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    fmt.Println(<span class="string">"finish"</span>)</span><br><span class="line"></span><br><span class="line">    done &lt;- <span class="literal">true</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> worker(done)</span><br><span class="line"></span><br><span class="line">    &lt;-done <span class="comment">// 由于有此读入操作的存在，只有当上一个协程完成时该协程才会结束，这句话如果删掉，则可能该协程直接结束</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">working...finish</span><br></pre></td></tr></tbody></table></figure>
<p>在函数中，还可以显式指明通道的方向</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ping</span><span class="params">(pings <span class="keyword">chan</span>&lt;- <span class="type">string</span>, msg <span class="type">string</span>)</span></span> { <span class="comment">// 该函数指明了一个只写通道</span></span><br><span class="line">    pings &lt;- msg</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pong</span><span class="params">(pings &lt;-<span class="keyword">chan</span> <span class="type">string</span>, pongs <span class="keyword">chan</span>&lt;- <span class="type">string</span>)</span></span> { <span class="comment">// 该函数第一个参数是一个只读通道，第二个是一个只写通道</span></span><br><span class="line">    msg := &lt;-pings</span><br><span class="line">    pongs &lt;- msg</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h3><p>当存在多个通道的时候，可以使用选择器 $select$ 来选择通道</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">        c1 &lt;- <span class="string">"one"</span></span><br><span class="line">    }()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">        c2 &lt;- <span class="string">"two"</span></span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ {</span><br><span class="line">        <span class="keyword">select</span> { <span class="comment">// 通过select实现</span></span><br><span class="line">        <span class="keyword">case</span> msg1 := &lt;-c1:</span><br><span class="line">            fmt.Println(<span class="string">"received"</span>, msg1)</span><br><span class="line">        <span class="keyword">case</span> msg2 := &lt;-c2:</span><br><span class="line">            fmt.Println(<span class="string">"received"</span>, msg2)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>基于 $select$ 关键字， $Go$ 实现超时处理就比较简单了</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">        c1 &lt;- <span class="string">"result 1"</span></span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> res := &lt;-c1: <span class="comment">// 否则，执行该case</span></span><br><span class="line">        fmt.Println(res)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second): <span class="comment">// 超过了设定的一秒，执行该case</span></span><br><span class="line">        fmt.Println(<span class="string">"timeout 1"</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">        c2 &lt;- <span class="string">"result 2"</span></span><br><span class="line">    }()</span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> res := &lt;-c2:</span><br><span class="line">        fmt.Println(res)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">3</span> * time.Second):</span><br><span class="line">        fmt.Println(<span class="string">"timeout 2"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出为</span></span><br><span class="line">timeout <span class="number">1</span></span><br><span class="line">result <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="非阻塞通道操作"><a href="#非阻塞通道操作" class="headerlink" title="非阻塞通道操作"></a>非阻塞通道操作</h3><p>通过 $select$ 和 $swicth$ 和 $default$ ，可以实现非阻塞通道操作</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    messages := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    signals := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> msg := &lt;-messages: <span class="comment">// messages存在内容，执行，否则说明发生了发送者的阻塞</span></span><br><span class="line">        fmt.Println(<span class="string">"received message"</span>, msg)</span><br><span class="line">    <span class="keyword">default</span>: <span class="comment">// 否则执行</span></span><br><span class="line">        fmt.Println(<span class="string">"no message received"</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    msg := <span class="string">"hi"</span></span><br><span class="line">    <span class="keyword">select</span> {</span><br><span class="line">    <span class="keyword">case</span> messages &lt;- msg: <span class="comment">// 如果无缓冲区以及不存在接收方，说明发生了接受者的阻塞，不执行</span></span><br><span class="line">        fmt.Println(<span class="string">"sent message"</span>, msg)</span><br><span class="line">    <span class="keyword">default</span>: <span class="comment">// 否则执行</span></span><br><span class="line">        fmt.Println(<span class="string">"no message sent"</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> { <span class="comment">// switch可以同时支持多个channel的非阻塞通道操作</span></span><br><span class="line">    <span class="keyword">case</span> msg := &lt;-messages:</span><br><span class="line">        fmt.Println(<span class="string">"received message"</span>, msg)</span><br><span class="line">    <span class="keyword">case</span> sig := &lt;-signals:</span><br><span class="line">        fmt.Println(<span class="string">"received signal"</span>, sig)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">"no activity"</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下，多次运行结果可能不同</span></span><br><span class="line">sent job <span class="number">1</span></span><br><span class="line">sent job <span class="number">2</span></span><br><span class="line">sent job <span class="number">3</span></span><br><span class="line">sent all jobs</span><br><span class="line">received job <span class="number">1</span></span><br><span class="line">received job <span class="number">2</span></span><br><span class="line">received job <span class="number">3</span></span><br><span class="line">received all jobs</span><br></pre></td></tr></tbody></table></figure>
<h3 id="关闭通道"><a href="#关闭通道" class="headerlink" title="关闭通道"></a>关闭通道</h3><p>我们还可以关闭通道，这样就可以向通道的接收方传递工作完成的消息。</p>
<p>对于非空的通道，也是可以关闭的</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">close</span>(channelName)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="通道遍历"><a href="#通道遍历" class="headerlink" title="通道遍历"></a>通道遍历</h3><p>对于一个通道，可以使用 $range$ 遍历其内容，即使通道已经关闭</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    queue := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">5</span>)</span><br><span class="line">    queue &lt;- <span class="string">"one"</span></span><br><span class="line">    queue &lt;- <span class="string">"two"</span></span><br><span class="line">    queue &lt;- <span class="string">"three"</span></span><br><span class="line">    <span class="built_in">close</span>(queue)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> elem := <span class="keyword">range</span> queue {</span><br><span class="line">        fmt.Println(elem)</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(&lt;-queue) <span class="comment">// 遍历后通道的元素会对应的消失，因此输出空</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">one</span><br><span class="line">two</span><br><span class="line">three</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h3><p>定时器可以帮助我们指定在未来的某个时间执行某段代码</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    timer1 := time.NewTimer(<span class="number">2</span> * time.Second) <span class="comment">// 设定时间为2秒，定时器会创建一个通道</span></span><br><span class="line"></span><br><span class="line">    &lt;-timer1.C <span class="comment">// 定时器会一直阻塞，直到设定的时间结束，此时C通道会发送值</span></span><br><span class="line">    fmt.Println(<span class="string">"Timer 1 fired"</span>)</span><br><span class="line"></span><br><span class="line">    timer2 := time.NewTimer(time.Second)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        &lt;-timer2.C</span><br><span class="line">        fmt.Println(<span class="string">"Timer 2 fired"</span>)</span><br><span class="line">    }()</span><br><span class="line">    stop2 := timer2.Stop() <span class="comment">// 与sleep最大不同在于定时器可以被提前结束，由于被提前结束了，因此Timer 2 fired不会输出</span></span><br><span class="line">    <span class="keyword">if</span> stop2 {</span><br><span class="line">        fmt.Println(<span class="string">"Timer 2 stopped"</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">Timer <span class="number">1</span> fired</span><br><span class="line">Timer <span class="number">2</span> stopped</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Ticker"><a href="#Ticker" class="headerlink" title="Ticker"></a>Ticker</h3><p>定时器是为了未来的某一个时刻准备的，而打点器则是某一个重复的时间间隔准备的。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    ticker := time.NewTicker(<span class="number">500</span> * time.Millisecond) <span class="comment">// 设定每500ms发送一个信息</span></span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">        <span class="keyword">for</span> {</span><br><span class="line">            <span class="keyword">select</span> {</span><br><span class="line">            <span class="keyword">case</span> &lt;-done:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">case</span> t := &lt;-ticker.C:</span><br><span class="line">                fmt.Println(<span class="string">"Tick at"</span>, t)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">1600</span> * time.Millisecond)</span><br><span class="line">    ticker.Stop() <span class="comment">// 打点器与定时器一样可以被停止</span></span><br><span class="line">    done &lt;- <span class="literal">true</span></span><br><span class="line">    fmt.Println(<span class="string">"Ticker stopped"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">Tick at <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">09</span>:<span class="number">28</span>:<span class="number">31.504327</span> +<span class="number">0800</span> CST m=+<span class="number">0.516202901</span></span><br><span class="line">Tick at <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">09</span>:<span class="number">28</span>:<span class="number">31.991619</span> +<span class="number">0800</span> CST m=+<span class="number">1.003494901</span></span><br><span class="line">Tick at <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">09</span>:<span class="number">28</span>:<span class="number">32.4938115</span> +<span class="number">0800</span> CST m=+<span class="number">1.505687401</span></span><br><span class="line">Ticker stopped</span><br></pre></td></tr></tbody></table></figure>
<h3 id="工作池"><a href="#工作池" class="headerlink" title="工作池"></a>工作池</h3><p>通过协程与通道，可以实现一个工作池</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="type">int</span>, jobs &lt;-<span class="keyword">chan</span> <span class="type">int</span>, results <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> {</span><br><span class="line">    <span class="keyword">for</span> j := <span class="keyword">range</span> jobs {</span><br><span class="line">        fmt.Println(<span class="string">"worker"</span>, id, <span class="string">"started  job"</span>, j)</span><br><span class="line">        time.Sleep(time.Second) <span class="comment">// 模拟任务执行</span></span><br><span class="line">        fmt.Println(<span class="string">"worker"</span>, id, <span class="string">"finished job"</span>, j)</span><br><span class="line">        results &lt;- j * <span class="number">2</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> numJobs = <span class="number">5</span></span><br><span class="line">    jobs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, numJobs)</span><br><span class="line">    results := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, numJobs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> w := <span class="number">1</span>; w &lt;= <span class="number">3</span>; w++ { <span class="comment">// 创建了三个协程</span></span><br><span class="line">        <span class="keyword">go</span> worker(w, jobs, results)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= numJobs; j++ { <span class="comment">// 写入任务</span></span><br><span class="line">        jobs &lt;- j</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">close</span>(jobs) <span class="comment">// 关闭通道</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> a := <span class="number">1</span>; a &lt;= numJobs; a++ { <span class="comment">// 开始执行任务</span></span><br><span class="line">        &lt;-results</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">worker <span class="number">3</span> started  job <span class="number">2</span></span><br><span class="line">worker <span class="number">1</span> started  job <span class="number">1</span></span><br><span class="line">worker <span class="number">2</span> started  job <span class="number">3</span></span><br><span class="line">worker <span class="number">2</span> finished job <span class="number">3</span></span><br><span class="line">worker <span class="number">2</span> started  job <span class="number">4</span></span><br><span class="line">worker <span class="number">3</span> finished job <span class="number">2</span></span><br><span class="line">worker <span class="number">1</span> finished job <span class="number">1</span></span><br><span class="line">worker <span class="number">3</span> started  job <span class="number">5</span></span><br><span class="line">worker <span class="number">3</span> finished job <span class="number">5</span></span><br><span class="line">worker <span class="number">2</span> finished job <span class="number">4</span></span><br><span class="line"><span class="comment">// 总的耗时不超过3s，因为是多个协程并发执行的</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="等待多个协程"><a href="#等待多个协程" class="headerlink" title="等待多个协程"></a>等待多个协程</h3><p>在 $Go$ 中，可以使用 $WaitGroup$ 来等待多个协程</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="type">int</span>)</span></span> {</span><br><span class="line">    fmt.Printf(<span class="string">"Worker %d starting\n"</span>, id)</span><br><span class="line"></span><br><span class="line">    time.Sleep(time.Second) <span class="comment">// 模拟执行任务</span></span><br><span class="line">    fmt.Printf(<span class="string">"Worker %d done\n"</span>, id)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup <span class="comment">// 别名，注意WaitGroup如果要显示传递到函数中，需要使用指针</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {</span><br><span class="line">        wg.Add(<span class="number">1</span>) <span class="comment">// 计数器加一</span></span><br><span class="line"></span><br><span class="line">        i := i <span class="comment">// 见27行</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">            <span class="keyword">defer</span> wg.Done() <span class="comment">// 计数器减一</span></span><br><span class="line">            worker(i) <span class="comment">// 需要注意，go并发编程使用闭包和goroutine时由于会自动获取外部环境，而在gorountine内由于使用了外部变量i，因此直到整个循环结束之前都不会真正开始执行</span></span><br><span class="line">            <span class="comment">// goroutine，因此如果删掉23行，会发现所有的调用的worker函数执行的id都是6</span></span><br><span class="line">        }()</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    wg.Wait() <span class="comment">// 等待执行完成</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="原子操作"><a href="#原子操作" class="headerlink" title="原子操作"></a>原子操作</h3><p>原子操作是不可分割的最小操作单元，在并发编程中尤为重要。</p>
<p>在 $Go$ 中，可以使用 $sync/atomic$ 包中的函数实现一些简单的原子操作。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line">    <span class="string">"sync/atomic"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ops <span class="type">uint64</span> <span class="comment">// 用于写的变量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup <span class="comment">// 等待多个协程</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">50</span>; i++ {</span><br><span class="line">        wg.Add(<span class="number">1</span>) <span class="comment">// 等待的协程+1</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> {</span><br><span class="line">            <span class="keyword">for</span> c := <span class="number">0</span>; c &lt; <span class="number">1000</span>; c++ {</span><br><span class="line">                atomic.AddUint64(&amp;ops, <span class="number">1</span>) <span class="comment">// 注意第一个参数必须是指针，每次对ops+1</span></span><br><span class="line">            }</span><br><span class="line">            wg.Done() <span class="comment">// 等待的协程-1</span></span><br><span class="line">        }()</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    wg.Wait() <span class="comment">// 等待所有协程</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"ops:"</span>, ops) <span class="comment">// 输出结果</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">ops: <span class="number">50000</span></span><br></pre></td></tr></tbody></table></figure>
<p>由于使用了原子操作，不同的协程就不会互相干扰了。</p>
<h3 id="速率限制"><a href="#速率限制" class="headerlink" title="速率限制"></a>速率限制</h3><p>在 $Go$ 中，通过通道、协程和打点器可以实现速率限制</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    requests := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">5</span>) <span class="comment">// 创建一个具有五个缓冲区的通道</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {</span><br><span class="line">        requests &lt;- i</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">close</span>(requests)</span><br><span class="line"></span><br><span class="line">    limiter := time.Tick(<span class="number">200</span> * time.Millisecond) <span class="comment">// 设置一个打点器，每200毫秒一次打点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> req := <span class="keyword">range</span> requests {</span><br><span class="line">        &lt;-limiter <span class="comment">// 通过接收方接收，实现每200ms一次输出</span></span><br><span class="line">        fmt.Println(<span class="string">"request"</span>, req, time.Now())</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">request <span class="number">1</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">07</span>:<span class="number">56.4961913</span> +<span class="number">0800</span> CST m=+<span class="number">0.210996801</span></span><br><span class="line">request <span class="number">2</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">07</span>:<span class="number">56.7000601</span> +<span class="number">0800</span> CST m=+<span class="number">0.414865601</span></span><br><span class="line">request <span class="number">3</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">07</span>:<span class="number">56.8889462</span> +<span class="number">0800</span> CST m=+<span class="number">0.603751701</span></span><br><span class="line">request <span class="number">4</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">07</span>:<span class="number">57.0962226</span> +<span class="number">0800</span> CST m=+<span class="number">0.811028101</span></span><br><span class="line">request <span class="number">5</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">07</span>:<span class="number">57.3022961</span> +<span class="number">0800</span> CST m=+<span class="number">1.017101601</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果需要在限制速率的同时，又希望能够允许短暂的并发，可以利用有缓冲通道</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    burstyLimiter := <span class="built_in">make</span>(<span class="keyword">chan</span> time.Time, <span class="number">3</span>) <span class="comment">// 创建一个有缓冲通道</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ {</span><br><span class="line">        burstyLimiter &lt;- time.Now()</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { <span class="comment">// 启动一个协程，每200ms计入</span></span><br><span class="line">        <span class="keyword">for</span> t := <span class="keyword">range</span> time.Tick(<span class="number">200</span> * time.Millisecond) {</span><br><span class="line">            burstyLimiter &lt;- t</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    burstyRequests := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">5</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ {</span><br><span class="line">        burstyRequests &lt;- i</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">close</span>(burstyRequests)</span><br><span class="line">    <span class="keyword">for</span> req := <span class="keyword">range</span> burstyRequests { <span class="comment">// 由于是并发的，并且有缓冲通道已满，接收方已准备好接收，前三个可以直接接收</span></span><br><span class="line">        &lt;-burstyLimiter</span><br><span class="line">        fmt.Println(<span class="string">"request"</span>, req, time.Now())</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下，可以看到，前三个输出的时间非常接近，后两个输出的时间大约差了200ms</span></span><br><span class="line">request <span class="number">1</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">09</span>:<span class="number">58.074396</span> +<span class="number">0800</span> CST m=+<span class="number">0.002069901</span></span><br><span class="line">request <span class="number">2</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">09</span>:<span class="number">58.0842918</span> +<span class="number">0800</span> CST m=+<span class="number">0.011965701</span></span><br><span class="line">request <span class="number">3</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">09</span>:<span class="number">58.0842918</span> +<span class="number">0800</span> CST m=+<span class="number">0.011965701</span></span><br><span class="line">request <span class="number">4</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">09</span>:<span class="number">58.2798433</span> +<span class="number">0800</span> CST m=+<span class="number">0.207517201</span></span><br><span class="line">request <span class="number">5</span> <span class="number">2023</span><span class="number">-01</span><span class="number">-14</span> <span class="number">11</span>:<span class="number">09</span>:<span class="number">58.4865907</span> +<span class="number">0800</span> CST m=+<span class="number">0.414264601</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h3><p>锁是计算机为了安全的读写数据所设计的结构</p>
<p>在 $Go$ 中，可以使用 $sync.Mutex$ 创建一个互斥锁</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Container <span class="keyword">struct</span> { <span class="comment">// 创建一个结构体，含有一个锁的成员</span></span><br><span class="line">    mu       sync.Mutex <span class="comment">// 创建一个锁</span></span><br><span class="line">    counters <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Container)</span></span> inc(name <span class="type">string</span>) { <span class="comment">// 对于一个锁，或者含有锁的结构，必须使用指针</span></span><br><span class="line"></span><br><span class="line">    c.mu.Lock() <span class="comment">// 加锁</span></span><br><span class="line">    <span class="keyword">defer</span> c.mu.Unlock() <span class="comment">// 解锁，可以使用defer管理什么时候解锁</span></span><br><span class="line">    c.counters[name]++</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    c := Container{ <span class="comment">// 互斥锁的0值可以被默认初始化，因此这里可以不需要显示构造</span></span><br><span class="line"></span><br><span class="line">        counters: <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>{<span class="string">"a"</span>: <span class="number">0</span>, <span class="string">"b"</span>: <span class="number">0</span>},</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup <span class="comment">// 创建一个WaitGroup</span></span><br><span class="line"></span><br><span class="line">    doIncrement := <span class="function"><span class="keyword">func</span><span class="params">(name <span class="type">string</span>, n <span class="type">int</span>)</span></span> { <span class="comment">// 创建一个闭包</span></span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ {</span><br><span class="line">            c.inc(name)</span><br><span class="line">        }</span><br><span class="line">        wg.Done() <span class="comment">// 减一</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    wg.Add(<span class="number">3</span>) <span class="comment">// 表示需要等待三个协程，下面开始执行三个协程</span></span><br><span class="line">    <span class="keyword">go</span> doIncrement(<span class="string">"a"</span>, <span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">go</span> doIncrement(<span class="string">"a"</span>, <span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">go</span> doIncrement(<span class="string">"b"</span>, <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">    wg.Wait() <span class="comment">// 等待所有协程执行完毕</span></span><br><span class="line">    fmt.Println(c.counters) <span class="comment">// 由于在函数执行时对数据加锁，因此多个协程不会同时读写数据，输出符合预期</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line"><span class="keyword">map</span>[a:<span class="number">20000</span> b:<span class="number">10000</span>]</span><br></pre></td></tr></tbody></table></figure>
<h3 id="状态协程"><a href="#状态协程" class="headerlink" title="状态协程"></a>状态协程</h3><p>待补充。。。</p>
<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p>在 $Go$ 中，可以使用 $sort.数据类型s$ 来排序，可以使用 $sort.数据类型sAreSorted$ 来确认是否已经有序</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    strs := []<span class="type">string</span>{<span class="string">"cc"</span>, <span class="string">"ac"</span>, <span class="string">"bc"</span>}</span><br><span class="line">    sort.Strings(strs)</span><br><span class="line">    fmt.Println(<span class="string">"Strings:"</span>, strs)</span><br><span class="line"></span><br><span class="line">    ints := []<span class="type">int</span>{<span class="number">7</span>, <span class="number">2</span>, <span class="number">4</span>}</span><br><span class="line">    sort.Ints(ints)</span><br><span class="line">    fmt.Println(<span class="string">"Ints:   "</span>, ints)</span><br><span class="line"></span><br><span class="line">    s := sort.IntsAreSorted(ints)</span><br><span class="line">    fmt.Println(<span class="string">"Sorted: "</span>, s)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">Strings: [ac bc cc]</span><br><span class="line">Ints:    [<span class="number">2</span> <span class="number">4</span> <span class="number">7</span>]</span><br><span class="line">Sorted:  <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="自定义排序"><a href="#自定义排序" class="headerlink" title="自定义排序"></a>自定义排序</h3><p>在 $Go$ 中，要实现自定义排序，需要实现 $sort.Interface$ 接口</p>
<p>这个接口的定义如下</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> {</span><br><span class="line">	<span class="comment">// Len is the number of elements in the collection.</span></span><br><span class="line">	Len() <span class="type">int</span></span><br><span class="line">	<span class="comment">// Less reports whether the element with</span></span><br><span class="line">	<span class="comment">// index i should sort before the element with index j.</span></span><br><span class="line">	Less(i, j <span class="type">int</span>) <span class="type">bool</span></span><br><span class="line">	<span class="comment">// Swap swaps the elements with indexes i and j.</span></span><br><span class="line">	Swap(i, j <span class="type">int</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>因此需要实现 $Len、Less、Swap$ 三个方法，并在调用中给出类型，结构体类似</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> byLength []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s byLength)</span></span> Len() <span class="type">int</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s byLength)</span></span> Swap(i, j <span class="type">int</span>) {</span><br><span class="line">    s[i], s[j] = s[j], s[i]</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s byLength)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(s[i]) &lt; <span class="built_in">len</span>(s[j])</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    fruits := []<span class="type">string</span>{<span class="string">"peach"</span>, <span class="string">"banana"</span>, <span class="string">"kiwi"</span>}</span><br><span class="line">    sort.Sort(byLength(fruits)) <span class="comment">// 调用时需要给出类型</span></span><br><span class="line">    fmt.Println(fruits)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出结果如下</span></span><br><span class="line">[kiwi peach banana]</span><br></pre></td></tr></tbody></table></figure>
<h2 id="常用关键字"><a href="#常用关键字" class="headerlink" title="常用关键字"></a>常用关键字</h2><h3 id="Panic"><a href="#Panic" class="headerlink" title="Panic"></a>Panic</h3><p>$panic$ 用于表示预期之外的错误，当调用 $panic$ 时，会自动中断程序</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"os"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"a problem occur"</span>)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line"><span class="built_in">panic</span>: a problem </span><br><span class="line"></span><br><span class="line">goroutine <span class="number">1</span> [running]: </span><br><span class="line">main.main()</span><br><span class="line">        c:/Users/Rose/Desktop/blog/<span class="keyword">go</span>/test.<span class="keyword">go</span>:<span class="number">7</span> +<span class="number">0x27</span></span><br><span class="line">exit status <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<p>程序终止后，会返回运行时的信息，比如文件路径，协程的情况等</p>
<h3 id="Defer"><a href="#Defer" class="headerlink" title="Defer"></a>Defer</h3><p>在 $Go$ 中，由于其处理异常的机制不同于其他语言，因此不具有 $try、catch、finally$ 的结构，而 $defer$ 关键字，就是为了解决这个问题的一部分而设计的，其作用在一定程度上相当于 $finally$ 。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    f := createFile(<span class="string">"defer.txt"</span>)</span><br><span class="line">    <span class="keyword">defer</span> closeFile(f) <span class="comment">// 通过defer，程序可以在正确的时候关闭文件</span></span><br><span class="line">    writeFile(f)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createFile</span><span class="params">(p <span class="type">string</span>)</span></span> *os.File {</span><br><span class="line">    fmt.Println(<span class="string">"creating"</span>)</span><br><span class="line">    f, err := os.Create(p)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeFile</span><span class="params">(f *os.File)</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"writing"</span>)</span><br><span class="line">    fmt.Fprintln(f, <span class="string">"data"</span>)</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">closeFile</span><span class="params">(f *os.File)</span></span> {</span><br><span class="line">    fmt.Println(<span class="string">"closing"</span>)</span><br><span class="line">    err := f.Close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        fmt.Fprintf(os.Stderr, <span class="string">"error: %v\n"</span>, err)</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">creating</span><br><span class="line">writing</span><br><span class="line">closing</span><br><span class="line"><span class="comment">// 除此之外，运行这段代码，还可以在当前文件夹下生成一个名为defer.txt的文件，其内容如下</span></span><br><span class="line">data</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Recover"><a href="#Recover" class="headerlink" title="Recover"></a>Recover</h3><p>$recover$ 与 $panic$ 相对，$panic$ 会终止程序，而 $recover$ 会阻止 $panic$ 终止程序，使程序继续运行。</p>
<p>一个经典的例子是 $Go$ 的 $net/htpp$ 包，这个包在处理 $HTTP$ 服务时，就采用了这样的方式：如果客户端出现严重错误，服务器不崩溃，转而关闭该链接并继续为其他客户端提供服务。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myPanic</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"a problem"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { <span class="comment">// recover必须在defer中运行</span></span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> { <span class="comment">// recover的返回值其捕获的panic</span></span><br><span class="line"></span><br><span class="line">            fmt.Println(<span class="string">"Recovered. Error:\n"</span>, r)</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    myPanic() <span class="comment">// 引起一个panic</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"After mayPanic()"</span>) <span class="comment">// 这句话不会输出，见下面的分析</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">Recovered. Error:</span><br><span class="line"> a problem</span><br></pre></td></tr></tbody></table></figure>
<p>下面简单描述一下这段代码的执行过程：</p>
<p>首先执行了 $main$ 函数，在 $main$ 函数内我们有一个 $defer$ 其使用了 $recover$ 去捕获 $panic$ ，随后我们调用了 $myPanic$ 函数，在这个函数中，我们引起了一个 $panic$ 而在这个函数中并不存在可以处理该 $panic$ 的 $recover$ ，因此 $myPanic$ 函数直接结束，返回到 $main$ ，在 $main$ 中，存在一个 $recover$ ，因此此时将其捕获，但是由于在 $myPanic$ 中已经引起了一个 $panic$ ，对于 $main$ 函数而言，其执行在调用 $myPanic$ 处已经停止了，当 $main$ 的 $defer$ 处理完毕后，程序直接结束。</p>
<p>如果我们将这一段 $defer$ 移到 $myPanic$ 之内，由于处理 $panic$ 的 $recover$ 会直接终止 $panic$ ，因此此时程序正常运行，见下方代码：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mayPanic</span><span class="params">()</span></span> {</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> { <span class="comment">// recover必须在defer中运行</span></span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> { </span><br><span class="line"></span><br><span class="line">            fmt.Println(<span class="string">"Recovered. Error:\n"</span>, r)</span><br><span class="line">        }</span><br><span class="line">    }()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"a problem"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    mayPanic() <span class="comment">// 引起一个panic</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"After mayPanic()"</span>) <span class="comment">// 正常运行</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">Recovered. Error:</span><br><span class="line"> a problem</span><br><span class="line">After mayPanic()</span><br></pre></td></tr></tbody></table></figure>
<h2 id="时间库"><a href="#时间库" class="headerlink" title="时间库"></a>时间库</h2><p>在 $Go$ 中提供了丰富的时间相关的函数</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    p := fmt.Println</span><br><span class="line"></span><br><span class="line">    now := time.Now() <span class="comment">// 获取当前时间</span></span><br><span class="line">    p(now)</span><br><span class="line"></span><br><span class="line">    then := time.Date(<span class="number">2009</span>, <span class="number">11</span>, <span class="number">17</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">58</span>, <span class="number">651387237</span>, time.UTC) <span class="comment">// 构造时间</span></span><br><span class="line">    p(then)</span><br><span class="line"></span><br><span class="line">    p(then.Year())</span><br><span class="line">    p(then.Month())</span><br><span class="line">    p(then.Day())</span><br><span class="line">    p(then.Hour())</span><br><span class="line">    p(then.Minute())</span><br><span class="line">    p(then.Second())</span><br><span class="line">    p(then.Nanosecond())</span><br><span class="line">    p(then.Location()) <span class="comment">// 获取时区</span></span><br><span class="line"></span><br><span class="line">    p(then.Weekday()) <span class="comment">// 获取是星期几</span></span><br><span class="line"></span><br><span class="line">    p(then.Before(now)) <span class="comment">// 查看当前时间是否在输入参数的时间之前，After和Equal类似</span></span><br><span class="line">    p(then.After(now))</span><br><span class="line">    p(then.Equal(now))</span><br><span class="line"></span><br><span class="line">    diff := now.Sub(then) <span class="comment">// 查看时间差</span></span><br><span class="line">    p(diff)</span><br><span class="line"></span><br><span class="line">    p(diff.Hours())</span><br><span class="line">    p(diff.Minutes())</span><br><span class="line">    p(diff.Seconds())</span><br><span class="line">    p(diff.Nanoseconds())</span><br><span class="line"></span><br><span class="line">    p(then.Add(diff)) <span class="comment">// 将当前时间加上一段，负数为减去一段</span></span><br><span class="line">    p(then.Add(-diff))</span><br><span class="line">    </span><br><span class="line">    p(then.Unix()) <span class="comment">// 输出从Unix纪元起到现在的时间</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-13</span> <span class="number">11</span>:<span class="number">05</span>:<span class="number">35.1118395</span> +<span class="number">0800</span> CST m=+<span class="number">0.003202901</span></span><br><span class="line"><span class="number">2009</span><span class="number">-11</span><span class="number">-17</span> <span class="number">20</span>:<span class="number">34</span>:<span class="number">58.651387237</span> +<span class="number">0000</span> UTC</span><br><span class="line"><span class="number">2009</span></span><br><span class="line">November</span><br><span class="line"><span class="number">17</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">34</span></span><br><span class="line"><span class="number">58</span></span><br><span class="line"><span class="number">651387237</span></span><br><span class="line">UTC</span><br><span class="line">Tuesday</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="number">115302</span>h30m36<span class="number">.460452263</span>s</span><br><span class="line"><span class="number">115302.51012790341</span></span><br><span class="line"><span class="number">6.918150607674205e+06</span></span><br><span class="line"><span class="number">4.1508903646045226e+08</span></span><br><span class="line"><span class="number">415089036460452263</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-13</span> <span class="number">03</span>:<span class="number">05</span>:<span class="number">35.1118395</span> +<span class="number">0000</span> UTC</span><br><span class="line"><span class="number">1996</span><span class="number">-09</span><span class="number">-22</span> <span class="number">14</span>:<span class="number">04</span>:<span class="number">22.190934974</span> +<span class="number">0000</span> UTC</span><br><span class="line"><span class="number">1258490098</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="时间的格式化"><a href="#时间的格式化" class="headerlink" title="时间的格式化"></a>时间的格式化</h3><p>在 $Go$ 中，使用 $time$ 库可以支持借助描述来解析时间的格式。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    p := fmt.Println</span><br><span class="line"></span><br><span class="line">    t := time.Now()</span><br><span class="line">    p(t.Format(time.RFC3339)) <span class="comment">// 使用time.RFC3339的标准来布局格式化</span></span><br><span class="line"></span><br><span class="line">    t1, e := time.Parse(</span><br><span class="line">        time.RFC3339,</span><br><span class="line">        <span class="string">"2012-11-01T22:08:41+00:00"</span>) <span class="comment">// 类似，第一个参数为标准，第二个参数为要被格式化的时间</span></span><br><span class="line">    p(t1)</span><br><span class="line"></span><br><span class="line">    p(t.Format(<span class="string">"3:04PM"</span>)) <span class="comment">// 可以自己指定格式化的时间，需要按照一定规则</span></span><br><span class="line">    p(t.Format(<span class="string">"Mon Jan _2 15:04:05 2006"</span>))</span><br><span class="line">    p(t.Format(<span class="string">"2006-01-02T15:04:05.999999-07:00"</span>))</span><br><span class="line">    form := <span class="string">"3 04 PM"</span></span><br><span class="line">    t2, e := time.Parse(form, <span class="string">"8 41 PM"</span>)</span><br><span class="line">    p(t2)</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">"%d-%02d-%02dT%02d:%02d:%02d-00:00\n"</span>,</span><br><span class="line">        t.Year(), t.Month(), t.Day(),</span><br><span class="line">        t.Hour(), t.Minute(), t.Second())</span><br><span class="line"></span><br><span class="line">    ansic := <span class="string">"Mon Jan _2 15:04:05 2006"</span></span><br><span class="line">    _, e = time.Parse(ansic, <span class="string">"8:41PM"</span>) <span class="comment">// 如果不匹配，会返回一个解析错误</span></span><br><span class="line">    p(e)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-14</span>T16:<span class="number">47</span>:<span class="number">31</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="number">2012</span><span class="number">-11</span><span class="number">-01</span> <span class="number">22</span>:<span class="number">08</span>:<span class="number">41</span> +<span class="number">0000</span> +<span class="number">0000</span></span><br><span class="line"><span class="number">4</span>:<span class="number">47</span>PM</span><br><span class="line">Sat Jan <span class="number">14</span> <span class="number">16</span>:<span class="number">47</span>:<span class="number">31</span> <span class="number">2023</span></span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-14</span>T16:<span class="number">47</span>:<span class="number">31.10381</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="number">0000</span><span class="number">-01</span><span class="number">-01</span> <span class="number">20</span>:<span class="number">41</span>:<span class="number">00</span> +<span class="number">0000</span> UTC</span><br><span class="line"><span class="number">2023</span><span class="number">-01</span><span class="number">-14</span>T16:<span class="number">47</span>:<span class="number">31</span><span class="number">-00</span>:<span class="number">00</span></span><br><span class="line">parsing time <span class="string">"8:41PM"</span> as <span class="string">"Mon Jan _2 15:04:05 2006"</span>: cannot parse <span class="string">"8:41PM"</span> as <span class="string">"Mon"</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="随机数"><a href="#随机数" class="headerlink" title="随机数"></a>随机数</h2><p>在 $math/rand$ 包中提供了丰富的支持随机数的方法。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"math/rand"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    fmt.Print(rand.Intn(<span class="number">100</span>), <span class="string">","</span>) <span class="comment">// 随机生成一个0到100的整数</span></span><br><span class="line">    fmt.Print(rand.Intn(<span class="number">100</span>))</span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    fmt.Println(rand.Float64()) <span class="comment">// 随机生成一个小数，0.0 &lt;= f &lt;= 1.0</span></span><br><span class="line"></span><br><span class="line">    fmt.Print((rand.Float64()*<span class="number">5</span>)+<span class="number">5</span>, <span class="string">","</span>) <span class="comment">// 通过数学变换</span></span><br><span class="line">    fmt.Print((rand.Float64() * <span class="number">5</span>) + <span class="number">5</span>)</span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    s1 := rand.NewSource(time.Now().UnixNano()) <span class="comment">// 默认情况下，种子是固定的，要想不固定种子，可以利用时间作为种子</span></span><br><span class="line">    r1 := rand.New(s1) <span class="comment">// 这种方法不够安全，如果想要安全生成随机数，需要使用 crypto/rand</span></span><br><span class="line"></span><br><span class="line">    fmt.Print(r1.Intn(<span class="number">100</span>), <span class="string">","</span>)</span><br><span class="line">    fmt.Print(r1.Intn(<span class="number">100</span>))</span><br><span class="line">    fmt.Println()</span><br><span class="line"></span><br><span class="line">    s2 := rand.NewSource(<span class="number">42</span>) <span class="comment">// 使用相同的种子的话，会生成相同的随机数序列</span></span><br><span class="line">    r2 := rand.New(s2)</span><br><span class="line">    fmt.Print(r2.Intn(<span class="number">100</span>), <span class="string">","</span>)</span><br><span class="line">    fmt.Print(r2.Intn(<span class="number">100</span>))</span><br><span class="line">    fmt.Println()</span><br><span class="line">    s3 := rand.NewSource(<span class="number">42</span>)</span><br><span class="line">    r3 := rand.New(s3)</span><br><span class="line">    fmt.Print(r3.Intn(<span class="number">100</span>), <span class="string">","</span>)</span><br><span class="line">    fmt.Print(r3.Intn(<span class="number">100</span>))</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line"><span class="number">81</span>,<span class="number">87</span></span><br><span class="line"><span class="number">0.6645600532184904</span></span><br><span class="line"><span class="number">7.1885709359349015</span>,<span class="number">7.123187485356329</span></span><br><span class="line"><span class="number">73</span>,<span class="number">29</span></span><br><span class="line"><span class="number">5</span>,<span class="number">87</span></span><br><span class="line"><span class="number">5</span>,<span class="number">87</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><h3 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h3><p>文件读写是非常重要的核心功能，在 $Go$ 中，可以通过 $os$ 实现读文件的操作。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"bufio"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(e <span class="type">error</span>)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> e != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(e)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    dat, err := os.ReadFile(<span class="string">"dat"</span>) <span class="comment">// 读取文件</span></span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Print(<span class="type">string</span>(dat))</span><br><span class="line"></span><br><span class="line">    f, err := os.Open(<span class="string">"dat"</span>) <span class="comment">// 打开文件</span></span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    b1 := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">5</span>)</span><br><span class="line">    n1, err := f.Read(b1) <span class="comment">// 读取固定的字节数，返回值为读取的字节大小，可能跟参数的大小不一致</span></span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Printf(<span class="string">"%d bytes: %s\n"</span>, n1, <span class="type">string</span>(b1[:n1]))</span><br><span class="line"></span><br><span class="line">    o2, err := f.Seek(<span class="number">6</span>, <span class="number">0</span>) <span class="comment">// 可以通过Seek来使文件指针移动到某一个位置</span></span><br><span class="line">    check(err)</span><br><span class="line">    b2 := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">2</span>)</span><br><span class="line">    n2, err := f.Read(b2)</span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Printf(<span class="string">"%d bytes @ %d: "</span>, n2, o2)</span><br><span class="line">    fmt.Printf(<span class="string">"%v\n"</span>, <span class="type">string</span>(b2[:n2]))</span><br><span class="line"></span><br><span class="line">    o3, err := f.Seek(<span class="number">6</span>, <span class="number">0</span>)</span><br><span class="line">    check(err)</span><br><span class="line">    b3 := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">2</span>)</span><br><span class="line">    n3, err := io.ReadAtLeast(f, b3, <span class="number">2</span>) <span class="comment">// 在io库中提供了更加健壮的方法来读取文件</span></span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Printf(<span class="string">"%d bytes @ %d: %s\n"</span>, n3, o3, <span class="type">string</span>(b3))</span><br><span class="line"></span><br><span class="line">    _, err = f.Seek(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    r4 := bufio.NewReader(f) <span class="comment">// 一个缓冲读取器，可能可以提高多次小读的效率</span></span><br><span class="line">    b4, err := r4.Peek(<span class="number">5</span>)</span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Printf(<span class="string">"5 bytes: %s\n"</span>, <span class="type">string</span>(b4))</span><br><span class="line"></span><br><span class="line">    f.Close() <span class="comment">// 文件读取结束后记得要关闭文件</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h3><p>在 $Go$ 中，可以用很多种方法写入文件，在 $bufio$ ， $os$ 库中都存在方法。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"bufio"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(e <span class="type">error</span>)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> e != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(e)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    d1 := []<span class="type">byte</span>(<span class="string">"hello\ngo\n"</span>)</span><br><span class="line">    err := os.WriteFile(<span class="string">"dat1"</span>, d1, <span class="number">0644</span>) <span class="comment">// 可以直接使用os.WriteFile向文件写入内容，如果文件不存在会创建文件</span></span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    f, err := os.Create(<span class="string">"dat2"</span>) <span class="comment">// 可以先创建一个文件</span></span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> f.Close() <span class="comment">// 通过defer保证文件关闭</span></span><br><span class="line"></span><br><span class="line">    d2 := []<span class="type">byte</span>{<span class="number">115</span>, <span class="number">111</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">10</span>}</span><br><span class="line">    n2, err := f.Write(d2) <span class="comment">// 向文件写入内容，并返回写入了几个bytes</span></span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Printf(<span class="string">"wrote %d bytes\n"</span>, n2)</span><br><span class="line"></span><br><span class="line">    n3, err := f.WriteString(<span class="string">"writes\n"</span>) <span class="comment">// 写入string</span></span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Printf(<span class="string">"wrote %d bytes\n"</span>, n3)</span><br><span class="line"></span><br><span class="line">    f.Sync() <span class="comment">// Sync可以将缓冲区的数据写入硬盘</span></span><br><span class="line"> </span><br><span class="line">    w := bufio.NewWriter(f) <span class="comment">// 一个带缓冲区的Writer</span></span><br><span class="line">    n4, err := w.WriteString(<span class="string">"buffered\n"</span>) <span class="comment">// 写入</span></span><br><span class="line">    check(err)</span><br><span class="line">    fmt.Printf(<span class="string">"wrote %d bytes\n"</span>, n4)</span><br><span class="line"></span><br><span class="line">    w.Flush() <span class="comment">// 通过Flush保证缓冲区的内容写入完毕</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>执行完毕后，会生成两个文件 $dat1$ 和 $dat2$ ,内容如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dat1:</span><br><span class="line">hello</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line">dat2:</span><br><span class="line">some</span><br><span class="line">writes</span><br><span class="line">buffered</span><br></pre></td></tr></tbody></table></figure>
<h3 id="行过滤器"><a href="#行过滤器" class="headerlink" title="行过滤器"></a>行过滤器</h3><p>通过行过滤器，可以获取每一行的数据。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"bufio"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    scanner := bufio.NewScanner(os.Stdin) <span class="comment">// 将无缓冲的输入流转为带缓冲的scanner</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> scanner.Scan() { <span class="comment">// 不断获取数据，直到EOF</span></span><br><span class="line">        ucl := strings.ToUpper(scanner.Text()) <span class="comment">// scanner.Text()是当前行</span></span><br><span class="line">        fmt.Println(ucl)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := scanner.Err(); err != <span class="literal">nil</span> { <span class="comment">// EOF不会被视为一个错误</span></span><br><span class="line">        fmt.Fprintln(os.Stderr, <span class="string">"error:"</span>, err)</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="文件路径"><a href="#文件路径" class="headerlink" title="文件路径"></a>文件路径</h3><p>对于不同的操作系统，其描述文件路径的方式可能有所不同，但是在 $Go$ 中，可以使用 $path/filepath$ 包来很方便解决这个问题。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"path/filepath"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    p := filepath.Join(<span class="string">"dir1"</span>, <span class="string">"dir2"</span>, <span class="string">"filename.txt"</span>) <span class="comment">// 使用Join方法可以拼接文件路径，该方法可以避免操作系统的差异导致的路径描述问题</span></span><br><span class="line">    fmt.Println(<span class="string">"p:"</span>, p)</span><br><span class="line"></span><br><span class="line">    fmt.Println(filepath.Join(<span class="string">"dir1//"</span>, <span class="string">"filename"</span>)) <span class="comment">// 该方法还可以去除多余的描述</span></span><br><span class="line">    fmt.Println(filepath.Join(<span class="string">"dir1/../dir1"</span>, <span class="string">"filename"</span>))</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"Dir(p):"</span>, filepath.Dir(p)) <span class="comment">// Dir可以获取文件当前所处的目录</span></span><br><span class="line">    fmt.Println(<span class="string">"Base(p):"</span>, filepath.Base(p)) <span class="comment">// Base可以获取当前文件的整体的名字（含扩展名）</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(filepath.IsAbs(<span class="string">"dir/file"</span>)) <span class="comment">// 判断是否是绝对路径</span></span><br><span class="line">    fmt.Println(filepath.IsAbs(<span class="string">"/dir/file"</span>))</span><br><span class="line"></span><br><span class="line">    filename := <span class="string">"config.json"</span></span><br><span class="line"></span><br><span class="line">    ext := filepath.Ext(filename) <span class="comment">// 获取文件的后缀扩展名（包括.）</span></span><br><span class="line">    fmt.Println(ext)</span><br><span class="line"></span><br><span class="line">    fmt.Println(strings.TrimSuffix(filename, ext)) <span class="comment">// 返回删除文件扩展名后的值</span></span><br><span class="line"></span><br><span class="line">    rel, err := filepath.Rel(<span class="string">"a/b"</span>, <span class="string">"a/b/t/file"</span>) <span class="comment">// 寻找第二个参数相对于第一个参数的路径，如果不存在，返回错误</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(rel)</span><br><span class="line"></span><br><span class="line">    rel, err = filepath.Rel(<span class="string">"a/b"</span>, <span class="string">"a/c/t/file"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(rel)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">p: dir1\dir2\filename.txt</span><br><span class="line">dir1\filename</span><br><span class="line">dir1\filename</span><br><span class="line">Dir(p): dir1\dir2</span><br><span class="line">Base(p): filename.txt</span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line">.json</span><br><span class="line">config</span><br><span class="line">t\file</span><br><span class="line">..\c\t\file</span><br></pre></td></tr></tbody></table></figure>
<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><p>通过 $os$ 和 $path/filepath$ 可以很方便实现目录的操作。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"path/filepath"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(e <span class="type">error</span>)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> e != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(e)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    err := os.Mkdir(<span class="string">"subdir"</span>, <span class="number">0755</span>) <span class="comment">// 使用Mkdir可以在当前目录下创建一个子目录，第二个参数用于描述文件的模式和权限位</span></span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> os.RemoveAll(<span class="string">"subdir"</span>) <span class="comment">// 保证程序结束后删除这个临时目录和下面的所有文件</span></span><br><span class="line"></span><br><span class="line">    createEmptyFile := <span class="function"><span class="keyword">func</span><span class="params">(name <span class="type">string</span>)</span></span> {</span><br><span class="line">        d := []<span class="type">byte</span>(<span class="string">""</span>)</span><br><span class="line">        check(os.WriteFile(name, d, <span class="number">0644</span>))</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    createEmptyFile(<span class="string">"subdir/file1"</span>)</span><br><span class="line"></span><br><span class="line">    err = os.MkdirAll(<span class="string">"subdir/parent/child"</span>, <span class="number">0755</span>) <span class="comment">// 可以创建一个有层级的目录</span></span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    createEmptyFile(<span class="string">"subdir/parent/file2"</span>)</span><br><span class="line">    createEmptyFile(<span class="string">"subdir/parent/file3"</span>)</span><br><span class="line">    createEmptyFile(<span class="string">"subdir/parent/child/file4"</span>)</span><br><span class="line"></span><br><span class="line">    c, err := os.ReadDir(<span class="string">"subdir/parent"</span>) <span class="comment">// 列出一个文件目录下的内容，返回一个os.DirEntry 类型的切片对象</span></span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"Listing subdir/parent"</span>)</span><br><span class="line">    <span class="keyword">for</span> _, entry := <span class="keyword">range</span> c {</span><br><span class="line">        fmt.Println(<span class="string">" "</span>, entry.Name(), entry.IsDir()) <span class="comment">// 列出名字，判断是否是文件夹</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    err = os.Chdir(<span class="string">"subdir/parent/child"</span>) <span class="comment">// 修改当前工作目录</span></span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    c, err = os.ReadDir(<span class="string">"."</span>)</span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"Listing subdir/parent/child"</span>)</span><br><span class="line">    <span class="keyword">for</span> _, entry := <span class="keyword">range</span> c {</span><br><span class="line">        fmt.Println(<span class="string">" "</span>, entry.Name(), entry.IsDir())</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    err = os.Chdir(<span class="string">"../../.."</span>)</span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"Visiting subdir"</span>)</span><br><span class="line">    err = filepath.Walk(<span class="string">"subdir"</span>, visit) <span class="comment">// 可以使用Walk遍历一个文件夹和内部的所有子文件夹，第二个参数是一个毁掉函数</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">visit</span><span class="params">(p <span class="type">string</span>, info os.FileInfo, err <span class="type">error</span>)</span></span> <span class="type">error</span> {</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    }</span><br><span class="line">    fmt.Println(<span class="string">" "</span>, p, info.IsDir())</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">Listing subdir/parent</span><br><span class="line">  child <span class="literal">true</span></span><br><span class="line">  file2 <span class="literal">false</span></span><br><span class="line">  file3 <span class="literal">false</span></span><br><span class="line">Listing subdir/parent/child</span><br><span class="line">  file4 <span class="literal">false</span></span><br><span class="line">Visiting subdir</span><br><span class="line">  subdir <span class="literal">true</span></span><br><span class="line">  subdir\file1 <span class="literal">false</span></span><br><span class="line">  subdir\parent <span class="literal">true</span></span><br><span class="line">  subdir\parent\child <span class="literal">true</span></span><br><span class="line">  subdir\parent\child\file4 <span class="literal">false</span></span><br><span class="line">  subdir\parent\file2 <span class="literal">false</span></span><br><span class="line">  subdir\parent\file3 <span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="临时文件与目录"><a href="#临时文件与目录" class="headerlink" title="临时文件与目录"></a>临时文件与目录</h3><p>在程序运行时，我们经常需要创建一些临时文件与目录，并在运行结束后删除，在 $Go$ 中，可以使用 $os$ 和 $path/pathfile$ 来解决这个问题。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"path/filepath"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(e <span class="type">error</span>)</span></span> {</span><br><span class="line">    <span class="keyword">if</span> e != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(e)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    f, err := os.CreateTemp(<span class="string">""</span>, <span class="string">"sample"</span>) <span class="comment">// 创建一个临时文件，第一个参数是创建的路径，为空表示当前目录，第二个参数是文件名，返回一个打开的文件</span></span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"Temp file name:"</span>, f.Name()) <span class="comment">// 获取文件名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> os.Remove(f.Name()) <span class="comment">// 使用defer保证程序结束后文件被删除</span></span><br><span class="line"></span><br><span class="line">    _, err = f.Write([]<span class="type">byte</span>{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>})</span><br><span class="line">    check(err)</span><br><span class="line"></span><br><span class="line">    dname, err := os.MkdirTemp(<span class="string">""</span>, <span class="string">"sampledir"</span>) <span class="comment">// 创建临时目录，参数含义相同，返回一个目录名</span></span><br><span class="line">    fmt.Println(<span class="string">"Temp dir name:"</span>, dname)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> os.RemoveAll(dname) <span class="comment">// 保证程序结束后目录被删除</span></span><br><span class="line"></span><br><span class="line">    fname := filepath.Join(dname, <span class="string">"file1"</span>)</span><br><span class="line">    err = os.WriteFile(fname, []<span class="type">byte</span>{<span class="number">1</span>, <span class="number">2</span>}, <span class="number">0666</span>)</span><br><span class="line">    check(err)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p>在 $Go$ 中，我们可以通过单元测试来检查我们的代码的运行。</p>
<p>使用单元测试，需要使用 $testing$ 库，在运行时使用 $go$  $test$ 命令。</p>
<p>一般情况下，被测试的代码如果名字为 $initial.go$ 的话，测试代码的文件被称为 $initial_test.go$ 。</p>
<p>单元测试的代码可以位于任何包下，而被测试的代码和测试代码通常在同一个包下。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 被测试的代码</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IntMin</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> {</span><br><span class="line">    <span class="keyword">if</span> a &lt; b {</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单元测试代码</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestIntMinBasic</span><span class="params">(t *testing.T)</span></span> { <span class="comment">// 一般测试的方法名以Test开头</span></span><br><span class="line">    ans := IntMin(<span class="number">2</span>, <span class="number">-2</span>)</span><br><span class="line">    <span class="keyword">if</span> ans != <span class="number">-2</span> {</span><br><span class="line"></span><br><span class="line">        t.Errorf(<span class="string">"IntMin(2, -2) = %d; want -2"</span>, ans) <span class="comment">// 该方法会输出失败信息，并继续测试，Fatal则会直接终止测试</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestIntMinTableDriven</span><span class="params">(t *testing.T)</span></span> { <span class="comment">// 单元测试可以以表驱动的方式同时进行多个子测试</span></span><br><span class="line">    <span class="keyword">var</span> tests = []<span class="keyword">struct</span> {</span><br><span class="line">        a, b <span class="type">int</span></span><br><span class="line">        want <span class="type">int</span></span><br><span class="line">    }{</span><br><span class="line">        {<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>},</span><br><span class="line">        {<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>},</span><br><span class="line">        {<span class="number">2</span>, <span class="number">-2</span>, <span class="number">-2</span>},</span><br><span class="line">        {<span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>},</span><br><span class="line">        {<span class="number">-1</span>, <span class="number">0</span>, <span class="number">-1</span>},</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, tt := <span class="keyword">range</span> tests {</span><br><span class="line"></span><br><span class="line">        testname := fmt.Sprintf(<span class="string">"%d,%d"</span>, tt.a, tt.b)</span><br><span class="line">        t.Run(testname, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> { <span class="comment">// 运行子测试</span></span><br><span class="line">            ans := IntMin(tt.a, tt.b)</span><br><span class="line">            <span class="keyword">if</span> ans != tt.want {</span><br><span class="line">                t.Errorf(<span class="string">"got %d, want %d"</span>, ans, tt.want)</span><br><span class="line">            }</span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 使用go test -v可以获取详细信息</span></span><br><span class="line">=== RUN   TestIntMinBasic</span><br><span class="line">--- PASS: TestIntMinBasic (<span class="number">0.00</span>s)</span><br><span class="line">=== RUN   TestIntMinTableDriven</span><br><span class="line">=== RUN   TestIntMinTableDriven/<span class="number">0</span>,<span class="number">1</span></span><br><span class="line">=== RUN   TestIntMinTableDriven/<span class="number">1</span>,<span class="number">0</span></span><br><span class="line">=== RUN   TestIntMinTableDriven/<span class="number">2</span>,<span class="number">-2</span></span><br><span class="line">=== RUN   TestIntMinTableDriven/<span class="number">0</span>,<span class="number">-1</span></span><br><span class="line">=== RUN   TestIntMinTableDriven/<span class="number">-1</span>,<span class="number">0</span></span><br><span class="line">--- PASS: TestIntMinTableDriven (<span class="number">0.00</span>s)</span><br><span class="line">    --- PASS: TestIntMinTableDriven/<span class="number">0</span>,<span class="number">1</span> (<span class="number">0.00</span>s)</span><br><span class="line">    --- PASS: TestIntMinTableDriven/<span class="number">1</span>,<span class="number">0</span> (<span class="number">0.00</span>s)</span><br><span class="line">    --- PASS: TestIntMinTableDriven/<span class="number">2</span>,<span class="number">-2</span> (<span class="number">0.00</span>s)</span><br><span class="line">    --- PASS: TestIntMinTableDriven/<span class="number">0</span>,<span class="number">-1</span> (<span class="number">0.00</span>s)</span><br><span class="line">    --- PASS: TestIntMinTableDriven/<span class="number">-1</span>,<span class="number">0</span> (<span class="number">0.00</span>s)</span><br><span class="line">PASS</span><br><span class="line">ok      hello/test      <span class="number">0.184</span>s</span><br></pre></td></tr></tbody></table></figure>
<p>基准测试一般必须以 $Benchmark$ 开头</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数名必须以Benchmark开头，参数必须为b *testing.B</span></span><br><span class="line"><span class="comment">// 运行时需要加 -bench=.参数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkIntMin</span><span class="params">(b *testing.B)</span></span> {</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ {</span><br><span class="line">        IntMin(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">goos: windows</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: hello/test</span><br><span class="line">cpu: AMD Ryzen <span class="number">7</span> <span class="number">4800</span>H with Radeon Graphics</span><br><span class="line">BenchmarkIntMin<span class="number">-16</span>      <span class="number">1000000000</span>               <span class="number">0.2447</span> ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      hello/test      <span class="number">0.469</span>s</span><br></pre></td></tr></tbody></table></figure>
<h2 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h2><p>命令行参数是指定程序运行参数的一个常见方式。</p>
<p>在 $Go$ 中，可以使用 $os.Args$ 来获取命令行参数。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    argsWithProg := os.Args</span><br><span class="line">    argsWithoutProg := os.Args[<span class="number">1</span>:] <span class="comment">// os.Args的第一个参数是地址，因此需要使用切片来获取真正的参数</span></span><br><span class="line"></span><br><span class="line">    arg := os.Args[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(argsWithProg)</span><br><span class="line">    fmt.Println(argsWithoutProg)</span><br><span class="line">    fmt.Println(arg)</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">10</span> * time.Second) <span class="comment">// 睡眠10s，方便观察输出</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 注意使用命令行操作</span></span><br><span class="line"><span class="comment">// go build test.go</span></span><br><span class="line"><span class="comment">// start ./test.exe arg1 arg2 arg3</span></span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">[./test.exe arg1 arg2 arg3]</span><br><span class="line">[arg1 arg2 arg3]</span><br><span class="line">arg3</span><br></pre></td></tr></tbody></table></figure>
<h3 id="命令行标志"><a href="#命令行标志" class="headerlink" title="命令行标志"></a>命令行标志</h3><p>有时候，我们仅仅获取命令行参数并不足够，比如在 $Linux$ 系统中，使用 $ls$ 命令时，我们可能希望获取到 $-l$  这样的命令行标志。</p>
<p>我们可以使用 $flag$ 来帮助实现这一功能。 </p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"flag"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    wordPtr := flag.String(<span class="string">"word"</span>, <span class="string">"foo"</span>, <span class="string">"a string"</span>) <span class="comment">// 使用flag.String 函数来给一个名为word的字符串标志加上"foo"的默认值和一个描述"a string"，返回值是一个指针</span></span><br><span class="line"></span><br><span class="line">    numbPtr := flag.Int(<span class="string">"numb"</span>, <span class="number">42</span>, <span class="string">"an int"</span>) <span class="comment">// 修改类型</span></span><br><span class="line">    forkPtr := flag.Bool(<span class="string">"fork"</span>, <span class="literal">false</span>, <span class="string">"a bool"</span>) <span class="comment">// 同上</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> svar <span class="type">string</span></span><br><span class="line">    flag.StringVar(&amp;svar, <span class="string">"svar"</span>, <span class="string">"bar"</span>, <span class="string">"a string var"</span>) <span class="comment">// 可以给一个已经存在的变量做相同的操作。</span></span><br><span class="line"></span><br><span class="line">    flag.Parse() <span class="comment">// 使用Parse解析</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"word:"</span>, *wordPtr)</span><br><span class="line">    fmt.Println(<span class="string">"numb:"</span>, *numbPtr)</span><br><span class="line">    fmt.Println(<span class="string">"fork:"</span>, *forkPtr)</span><br><span class="line">    fmt.Println(<span class="string">"svar:"</span>, svar)</span><br><span class="line">    fmt.Println(<span class="string">"tail:"</span>, flag.Args())</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 注意使用命令行操作</span></span><br><span class="line"><span class="comment">// go build test.go</span></span><br><span class="line"><span class="comment">// start ./test.exe -word=opt -numb=7 -fork -svar=flag</span></span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">word: opt</span><br><span class="line">numb: <span class="number">7</span></span><br><span class="line">fork: <span class="literal">true</span></span><br><span class="line">svar: flag</span><br><span class="line">tail: []</span><br></pre></td></tr></tbody></table></figure>
<p>注意：</p>
<p>如果省略了标志，那么该标志会是默认值。</p>
<p>标志必须出现在尾随的位置参数之前。</p>
<p>尾随的位置参数可以出现在任何标志后面。</p>
<p>使用 $-h$ 可以获得帮助文本。</p>
<p>如果使用了一个不存在的标志，那么会报错，并返回帮助文本。</p>
<h3 id="命令行子命令"><a href="#命令行子命令" class="headerlink" title="命令行子命令"></a>命令行子命令</h3><p>对于像 $git$，$Go$ 都存在很多的子命令，比如 $go$ $build$ 就是 $go$ 的一个子命令。</p>
<p>使用 $flag$ 可以帮助实现。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"flag"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    fooCmd := flag.NewFlagSet(<span class="string">"foo"</span>, flag.ExitOnError) <span class="comment">// 创建一个名为 "foo"，错误策略为 flag.ExitOnError的FlagSet，返回类型为*FlagSet</span></span><br><span class="line">    fooEnable := fooCmd.Bool(<span class="string">"enable"</span>, <span class="literal">false</span>, <span class="string">"enable"</span>) <span class="comment">// 为某个命令添加名为"enable"，默认值为false，使用信息为"enable"的子命令，返回一个保存了该flag的指针（这里为*bool）</span></span><br><span class="line">    fooName := fooCmd.String(<span class="string">"name"</span>, <span class="string">""</span>, <span class="string">"name"</span>) <span class="comment">// 类似的这里返回值为(*int)</span></span><br><span class="line"></span><br><span class="line">    barCmd := flag.NewFlagSet(<span class="string">"bar"</span>, flag.ExitOnError) <span class="comment">// 创建一个新的命令</span></span><br><span class="line">    barLevel := barCmd.Int(<span class="string">"level"</span>, <span class="number">0</span>, <span class="string">"level"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(os.Args) &lt; <span class="number">2</span> {</span><br><span class="line">        fmt.Println(<span class="string">"expected 'foo' or 'bar' subcommands"</span>)</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> os.Args[<span class="number">1</span>] { <span class="comment">// 查看结果</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"foo"</span>:</span><br><span class="line">        fooCmd.Parse(os.Args[<span class="number">2</span>:])</span><br><span class="line">        fmt.Println(<span class="string">"subcommand 'foo'"</span>)</span><br><span class="line">        fmt.Println(<span class="string">"  enable:"</span>, *fooEnable)</span><br><span class="line">        fmt.Println(<span class="string">"  name:"</span>, *fooName)</span><br><span class="line">        fmt.Println(<span class="string">"  tail:"</span>, fooCmd.Args())</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"bar"</span>:</span><br><span class="line">        barCmd.Parse(os.Args[<span class="number">2</span>:])</span><br><span class="line">        fmt.Println(<span class="string">"subcommand 'bar'"</span>)</span><br><span class="line">        fmt.Println(<span class="string">"  level:"</span>, *barLevel)</span><br><span class="line">        fmt.Println(<span class="string">"  tail:"</span>, barCmd.Args())</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">"expected 'foo' or 'bar' subcommands"</span>)</span><br><span class="line">        os.Exit(<span class="number">1</span>)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 注意使用命令行操作</span></span><br><span class="line"><span class="comment">// go build test.go</span></span><br><span class="line"><span class="comment">// start ./test.exe foo -enable -name=job arg3</span></span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">subcommand <span class="string">'foo'</span></span><br><span class="line">  enable: <span class="literal">true</span></span><br><span class="line">  name: job</span><br><span class="line">  tail: [arg3]</span><br></pre></td></tr></tbody></table></figure>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>目前似乎不重要，以后补</p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>$Go$ 的标准库的 $net/http$ 为实现 $http$ 提供了出色的支持。</p>
<h3 id="HTTP客户端"><a href="#HTTP客户端" class="headerlink" title="HTTP客户端"></a>HTTP客户端</h3><p>下面演示客户端的基本用法：</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"bufio"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">    <span class="string">"reflect"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    resp, err := http.Get(<span class="string">"http://gobyexample.com"</span>) <span class="comment">// 使用Get向一个URL发起请求，返回值是一个*http.Response</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close() <span class="comment">// 保证关闭</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"Response status:"</span>, resp.Status) <span class="comment">// 获取响应状态码，如果不是200说明存在问题</span></span><br><span class="line"></span><br><span class="line">    scanner := bufio.NewScanner(resp.Body) <span class="comment">// 读取请求体</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; scanner.Scan() &amp;&amp; i &lt; <span class="number">5</span>; i++ {</span><br><span class="line">        fmt.Println(scanner.Text())</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := scanner.Err(); err != <span class="literal">nil</span> {</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">Response status: <span class="number">200</span> OK</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Go by Example&lt;/title&gt;</span><br></pre></td></tr></tbody></table></figure>
<h3 id="HTTP服务端"><a href="#HTTP服务端" class="headerlink" title="HTTP服务端"></a>HTTP服务端</h3><p>$handlers$ 是 <code>net/http</code> 服务器里面的一个基本概念。 $handlers$ 对象实现了 <code>http.Handler</code> 接口。 编写 $handlers$ 的常见方法是，在具有适当签名的函数上使用 <code>http.HandlerFunc</code> 适配器。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> { <span class="comment">// handler 函数有两个参数，http.ResponseWriter 和 http.Request。 response writer 被用于写入 HTTP 响应数据</span></span><br><span class="line"></span><br><span class="line">    fmt.Fprintf(w, <span class="string">"hello\n"</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">headers</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> { <span class="comment">// 类似上面</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> name, headers := <span class="keyword">range</span> req.Header {</span><br><span class="line">        <span class="keyword">for</span> _, h := <span class="keyword">range</span> headers {</span><br><span class="line">            fmt.Fprintf(w, <span class="string">"%v: %v\n"</span>, name, h)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, hello) <span class="comment">// 使用 http.HandleFunc 函数，可以方便的将我们的 handler 注册到服务器路由。 它是 net/http 包中的默认路由，接受一个函数作为参数。</span></span><br><span class="line"></span><br><span class="line">    http.HandleFunc(<span class="string">"/headers"</span>, headers)</span><br><span class="line"></span><br><span class="line">    http.ListenAndServe(<span class="string">":8090"</span>, <span class="literal">nil</span>) <span class="comment">// 调用 ListenAndServe 并带上端口和 handler。 nil 表示使用我们刚刚设置的默认路由器。</span></span><br><span class="line">}</span><br><span class="line"><span class="comment">// 启动服务端</span></span><br><span class="line"><span class="comment">// go run test.go</span></span><br><span class="line"><span class="comment">// curl localhost:8090/hello</span></span><br><span class="line"><span class="comment">// 输出如下</span></span><br><span class="line">hello</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><p>$Context$ 被译为上下文，准确说是 $goroutine$ 的上下文，可以在 $goroutine$ 之间传递信息，通常用于并发控制，超时控制等。</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> {</span><br><span class="line"></span><br><span class="line">	ctx := req.Context() <span class="comment">// net/http 包封装了Context方法来构造一个Context</span></span><br><span class="line">	fmt.Println(<span class="string">"server: hello handler started"</span>)</span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(<span class="string">"server: hello handler ended"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">select</span> {</span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(<span class="number">10</span> * time.Second):</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"hello\n"</span>)</span><br><span class="line">	<span class="keyword">case</span> &lt;-ctx.Done(): <span class="comment">// 通过Done来监听</span></span><br><span class="line"></span><br><span class="line">		err := ctx.Err() <span class="comment">// Err会返回是否错误</span></span><br><span class="line">		fmt.Println(<span class="string">"server:"</span>, err)</span><br><span class="line">		internalError := http.StatusInternalServerError</span><br><span class="line">		http.Error(w, err.Error(), internalError)</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line"></span><br><span class="line">	http.HandleFunc(<span class="string">"/hello"</span>, hello)</span><br><span class="line">	http.ListenAndServe(<span class="string">":8090"</span>, <span class="literal">nil</span>)</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h2><p>在 $Go$ 中，类型断言的基本语法格式如下</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value, ok := x.(T)</span><br></pre></td></tr></tbody></table></figure>
<p>可以用于多态处理等</p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>在 $Go$ 中，通常采用一个独立的返回值来描述错误信息</p>
<figure class="highlight go"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"errors"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(arg <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">error</span>) {</span><br><span class="line">    <span class="keyword">if</span> arg == <span class="number">42</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>, errors.New(<span class="string">"can't work with 42"</span>)</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> arg + <span class="number">3</span>, <span class="literal">nil</span> <span class="comment">// 返回nil代表没有错误</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> argError <span class="keyword">struct</span> { <span class="comment">//这是一个自定义类型的错误</span></span><br><span class="line">    arg  <span class="type">int</span></span><br><span class="line">    prob <span class="type">string</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *argError)</span></span> Error() <span class="type">string</span> { <span class="comment">//需要使用自定义类型错误需要实现Error方法</span></span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%d - %s"</span>, e.arg, e.prob)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(arg <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">error</span>) {</span><br><span class="line">    <span class="keyword">if</span> arg == <span class="number">42</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>, &amp;argError{arg, <span class="string">"can't work with it"</span>}</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> arg + <span class="number">3</span>, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> {</span><br><span class="line">    <span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="type">int</span>{<span class="number">7</span>, <span class="number">42</span>} {</span><br><span class="line">        <span class="keyword">if</span> r, e := f1(i); e != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Println(<span class="string">"f1 failed:"</span>, e)</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            fmt.Println(<span class="string">"f1 worked:"</span>, r)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> _, i := <span class="keyword">range</span> []<span class="type">int</span>{<span class="number">7</span>, <span class="number">42</span>} {</span><br><span class="line">        <span class="keyword">if</span> r, e := f2(i); e != <span class="literal">nil</span> {</span><br><span class="line">            fmt.Println(<span class="string">"f2 failed:"</span>, e)</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            fmt.Println(<span class="string">"f2 worked:"</span>, r)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    _, e := f2(<span class="number">42</span>)</span><br><span class="line">    <span class="keyword">if</span> ae, ok := e.(*argError); ok { <span class="comment">// 需要获取错误的信息，需要使用类型断言</span></span><br><span class="line">        fmt.Println(ae.arg)</span><br><span class="line">        fmt.Println(ae.prob)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://gobyexample-cn.github.io/">Go by Example 中文版 (gobyexample-cn.github.io)</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://enthushtism.top">Enthushtism_</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://enthushtism.top/enthushtism/abb636b2.html">https://enthushtism.top/enthushtism/abb636b2.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://enthushtism.top" target="_blank">摘星崖</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/go/">go</a></div><div class="post_share"><div class="social-share" data-image="/img/%E5%88%9D%E8%AF%86go.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/enthushtism/ac475284.html"><img class="prev-cover" src="/img/%E4%B8%AA%E4%BA%BA%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">个人常用配置</div></div></a></div><div class="next-post pull-right"><a href="/enthushtism/a444b428.html"><img class="next-cover" src="/img/%E6%8E%92%E5%BA%8F.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">排序</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">Enthushtism_</div><div class="author-info__description">多爱一点这个世界，多拥抱一下世界</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/SaltyFishy"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/SaltyFishy" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/m0_53063591?spm=1000.2115.3001.5343" target="_blank" title="CSDN"><i class="fab fa-codiepie"></i></a><a class="social-icon" href="https://www.luogu.com.cn/user/645540" target="_blank" title="Luogu"><i class="fa fa-comment"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一个 sztuer 的稀奇古怪幻想屋~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Go"><span class="toc-number">1.</span> <span class="toc-text">Go</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F"><span class="toc-number">1.1.2.</span> <span class="toc-text">常量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#For%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.1.3.</span> <span class="toc-text">For循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#If-Else"><span class="toc-number">1.1.4.</span> <span class="toc-text">If/Else</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Switch"><span class="toc-number">1.1.5.</span> <span class="toc-text">Switch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">常用数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E7%89%87"><span class="toc-number">1.2.2.</span> <span class="toc-text">切片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">1.2.3.</span> <span class="toc-text">哈希表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.2.4.</span> <span class="toc-text">字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E6%95%B0%E5%AD%97%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">字符串与数字的转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">格式化输出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.2.4.4.</span> <span class="toc-text">文本模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON"><span class="toc-number">1.2.4.5.</span> <span class="toc-text">JSON</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.2.4.6.</span> <span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XML"><span class="toc-number">1.2.4.7.</span> <span class="toc-text">XML</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">函数结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.1.</span> <span class="toc-text">方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.3.2.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AD%E5%8C%85"><span class="toc-number">1.3.3.</span> <span class="toc-text">闭包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E5%8F%82%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.4.</span> <span class="toc-text">变参函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">泛型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">Go 并发编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E7%A8%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">协程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%81%93"><span class="toc-number">1.5.2.</span> <span class="toc-text">通道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-number">1.5.3.</span> <span class="toc-text">选择器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E9%98%BB%E5%A1%9E%E9%80%9A%E9%81%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.4.</span> <span class="toc-text">非阻塞通道操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E9%80%9A%E9%81%93"><span class="toc-number">1.5.5.</span> <span class="toc-text">关闭通道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%81%93%E9%81%8D%E5%8E%86"><span class="toc-number">1.5.6.</span> <span class="toc-text">通道遍历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Timer"><span class="toc-number">1.5.7.</span> <span class="toc-text">Timer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ticker"><span class="toc-number">1.5.8.</span> <span class="toc-text">Ticker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B1%A0"><span class="toc-number">1.5.9.</span> <span class="toc-text">工作池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E5%A4%9A%E4%B8%AA%E5%8D%8F%E7%A8%8B"><span class="toc-number">1.5.10.</span> <span class="toc-text">等待多个协程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.11.</span> <span class="toc-text">原子操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6"><span class="toc-number">1.5.12.</span> <span class="toc-text">速率限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%92%E6%96%A5%E9%94%81"><span class="toc-number">1.5.13.</span> <span class="toc-text">互斥锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E5%8D%8F%E7%A8%8B"><span class="toc-number">1.5.14.</span> <span class="toc-text">状态协程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">1.6.</span> <span class="toc-text">排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%92%E5%BA%8F"><span class="toc-number">1.6.1.</span> <span class="toc-text">自定义排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.7.</span> <span class="toc-text">常用关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Panic"><span class="toc-number">1.7.1.</span> <span class="toc-text">Panic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Defer"><span class="toc-number">1.7.2.</span> <span class="toc-text">Defer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recover"><span class="toc-number">1.7.3.</span> <span class="toc-text">Recover</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%93"><span class="toc-number">1.8.</span> <span class="toc-text">时间库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.8.1.</span> <span class="toc-text">时间的格式化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">1.9.</span> <span class="toc-text">随机数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6"><span class="toc-number">1.10.</span> <span class="toc-text">文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">1.10.1.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">1.10.2.</span> <span class="toc-text">写文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.10.3.</span> <span class="toc-text">行过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84"><span class="toc-number">1.10.4.</span> <span class="toc-text">文件路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.10.5.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E4%B8%8E%E7%9B%AE%E5%BD%95"><span class="toc-number">1.10.6.</span> <span class="toc-text">临时文件与目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">1.11.</span> <span class="toc-text">单元测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-number">1.12.</span> <span class="toc-text">命令行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A0%87%E5%BF%97"><span class="toc-number">1.12.1.</span> <span class="toc-text">命令行标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AD%90%E5%91%BD%E4%BB%A4"><span class="toc-number">1.12.2.</span> <span class="toc-text">命令行子命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.12.3.</span> <span class="toc-text">环境变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP"><span class="toc-number">1.13.</span> <span class="toc-text">HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.13.1.</span> <span class="toc-text">HTTP客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">1.13.2.</span> <span class="toc-text">HTTP服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Context"><span class="toc-number">1.13.3.</span> <span class="toc-text">Context</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80"><span class="toc-number">1.14.</span> <span class="toc-text">类型断言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.15.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.16.</span> <span class="toc-text">参考资料</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/enthushtism/942cf6c8.html" title="cpp-reference"><img src="/img/cpp-reference.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="cpp-reference"></a><div class="content"><a class="title" href="/enthushtism/942cf6c8.html" title="cpp-reference">cpp-reference</a><time datetime="2023-03-15T02:22:31.000Z" title="发表于 2023-03-15 10:22:31">2023-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/enthushtism/f255ffad.html" title="docker"><img src="/img/docker.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker"></a><div class="content"><a class="title" href="/enthushtism/f255ffad.html" title="docker">docker</a><time datetime="2023-01-20T13:46:56.000Z" title="发表于 2023-01-20 21:46:56">2023-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/enthushtism/4b4dbb3.html" title="hexo-butterfly"><img src="/img/hexo-butterfly.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo-butterfly"></a><div class="content"><a class="title" href="/enthushtism/4b4dbb3.html" title="hexo-butterfly">hexo-butterfly</a><time datetime="2023-01-09T08:01:33.000Z" title="发表于 2023-01-09 16:01:33">2023-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/enthushtism/9ac1aea8.html" title="组合数"><img src="/img/%E7%BB%84%E5%90%88%E6%95%B0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="组合数"></a><div class="content"><a class="title" href="/enthushtism/9ac1aea8.html" title="组合数">组合数</a><time datetime="2023-01-09T04:21:24.000Z" title="发表于 2023-01-09 12:21:24">2023-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/enthushtism/4173550e.html" title="FFT"><img src="/img/FFT.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="FFT"></a><div class="content"><a class="title" href="/enthushtism/4173550e.html" title="FFT">FFT</a><time datetime="2023-01-09T02:24:59.000Z" title="发表于 2023-01-09 10:24:59">2023-01-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">©2023/1/3 - 2023 By Enthushtism_</div><div class="framework-info"><span>ICP:</span>
<a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备2023028292号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'yQEOxaynnoS0xpejLnvwQGOM-gzGzoHsz',
      appKey: 'HIFfBBRsf20WHLklfma0EkX9',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="3868803653" data-server="tencent" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="线段树,稀疏表,KMP,今天不学习，明天变垃圾,树状数组,AC自动机,主席树,基环树,网络流,二分,平衡树,并查集,Dancing Link,单调栈,单调队列,分块,霍夫曼树,哈希表,可持久化,Suffix Array,Dijkstra,Floyd,Spfa(它死了),TopoSort,差分约束,Prim,Kruskal,Trie,dfs,bfs,Exgcd,高斯消元,Lucas定理,差分约束,快速幂,Tarjan,LCA,Flood Fill,A_star,双向Bfs,匈牙利算法,FFT,中国剩余定理,高精度,容斥原理,差分约束,单纯形法,负环,IDA*,矩阵,Prefix Sum,差分,树链剖分,扫描线,manacher,乘法逆元,三分,Z函数,String Hash,线性筛,莫队,裴蜀定理,线性同余方程" data-fontsize="20px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>